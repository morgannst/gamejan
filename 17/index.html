<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spelling Game for Kids</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Itim&family=Mali:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Tailwind Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Itim', 'cursive'],
                        head: ['Mali', 'cursive'],
                    },
                    colors: {
                        pastelPink: '#FFD1DC',
                        pastelPurple: '#E0BBE4',
                        pastelBlue: '#AEC6CF',
                        pastelYellow: '#FDFD96',
                        pastelGreen: '#B5EAD7',
                    },
                    animation: {
                        'bounce-slow': 'bounce-slow 3s infinite ease-in-out',
                        'pop-in': 'pop-in 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards',
                        'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both'
                    },
                    keyframes: {
                        'bounce-slow': {
                            '0%, 100%': { transform: 'translateY(-5px)' },
                            '50%': { transform: 'translateY(5px)' },
                        },
                        'pop-in': {
                            '0%': { transform: 'scale(0.8)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        },
                        'shake': {
                            '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' },
                            '20%, 80%': { transform: 'translate3d(2px, 0, 0)' },
                            '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' },
                            '40%, 60%': { transform: 'translate3d(4px, 0, 0)' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            /* Cute Gradient Background */
            background: linear-gradient(135deg, #FFD1DC, #E0BBE4, #AEC6CF);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            min-height: 100vh;
            font-family: 'Itim', cursive;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* Polka Dot Overlay */
        .bg-polka {
            background-image: radial-gradient(rgba(255, 255, 255, 0.4) 3px, transparent 3px);
            background-size: 30px 30px;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        /* Glassmorphism Card */
        .glass-card {
            background: rgba(255, 255, 255, 0.45);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 2px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
            border-radius: 24px;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(167, 139, 250, 0.5);
            border-radius: 10px;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen text-slate-700 relative selection:bg-pink-200">

    <div class="bg-polka"></div>

    <!-- Main Game Container -->
    <div id="app" class="w-full max-w-lg p-4 mx-auto relative z-10">
        
        <!-- Navigation (Home Button) -->
        <button id="btn-home" class="absolute top-0 left-0 m-2 p-3 bg-white/60 rounded-full hover:bg-white text-indigo-500 hover:text-indigo-600 transition shadow-sm z-40 hidden group" title="‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 transform group-hover:scale-110 transition" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
            </svg>
        </button>

        <!-- Toast Notification -->
        <div id="toast" class="fixed top-20 left-1/2 transform -translate-x-1/2 bg-red-400 text-white px-6 py-3 rounded-full shadow-lg opacity-0 pointer-events-none transition-opacity duration-300 z-50 font-bold">
            ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏•‡πà‡∏ô‡∏à‡πâ‡∏≤!
        </div>

        <!-- SCREEN: HOME -->
        <div id="screen-home" class="glass-card p-8 text-center animate-pop">
            <!-- Logo SVG -->
            <div class="w-32 h-32 mx-auto mb-6 animate-bounce-slow">
                <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="50" cy="50" r="45" fill="#FDFD96" stroke="#fff" stroke-width="4"/>
                    <path d="M30 40 Q50 20 70 40" stroke="#FFD1DC" stroke-width="5" stroke-linecap="round"/>
                    <circle cx="35" cy="55" r="5" fill="#333"/>
                    <circle cx="65" cy="55" r="5" fill="#333"/>
                    <path d="M45 65 Q50 75 55 65" stroke="#333" stroke-width="3" stroke-linecap="round"/>
                    <text x="50" y="30" font-family="'Mali', cursive" font-size="14" text-anchor="middle" fill="#FF80AB" font-weight="bold">ABC</text>
                    <circle cx="20" cy="30" r="3" fill="#AEC6CF"/>
                    <circle cx="80" cy="30" r="3" fill="#E0BBE4"/>
                </svg>
            </div>

            <h1 class="text-4xl font-head font-bold text-indigo-600 mb-2 drop-shadow-sm tracking-wide">Spelling Fun!</h1>
            
            <!-- Exam Info Badge -->
            <div class="inline-block bg-white/60 border border-indigo-200 rounded-lg px-6 py-3 mb-2 shadow-sm">
                <p class="text-indigo-600 font-bold text-lg">‡∏™‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 17</p>
                <p class="text-slate-500 text-sm">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 18 ‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏° 2529</p>
            </div>

            <!-- Sub-Header -->
            <h2 class="text-xl text-pink-500 font-bold mb-6">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠: ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà ‡πÄ‡∏ß‡∏•‡∏≤ ‡πÅ‡∏•‡∏∞‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å</h2>

            <div class="space-y-4 max-w-xs mx-auto">
                <div class="relative">
                    <input type="text" id="input-player-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡∏π..." class="w-full px-6 py-4 rounded-full border-2 border-white/60 bg-white/50 focus:outline-none focus:ring-4 focus:ring-indigo-200 focus:border-indigo-300 text-center text-xl placeholder-slate-400 transition-all text-indigo-600 font-bold">
                </div>
                
                <button id="btn-start" class="w-full py-4 bg-gradient-to-r from-pink-400 to-indigo-400 hover:from-pink-500 hover:to-indigo-500 text-white text-2xl font-bold rounded-full shadow-lg hover:scale-105 transform transition hover:shadow-xl active:scale-95">
                    ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏•‡∏¢! üéÆ
                </button>
            </div>

            <!-- High Score Section -->
            <div class="mt-8 bg-white/40 rounded-2xl p-5 border border-white/60">
                <div class="flex items-center justify-center gap-2 mb-3">
                    <span class="text-2xl">üèÜ</span>
                    <h3 class="text-xl font-bold text-indigo-500">‡∏Ñ‡∏ô‡πÄ‡∏Å‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</h3>
                </div>
                <div class="bg-white/40 rounded-xl p-2 h-32 overflow-y-auto custom-scroll">
                    <ul id="list-highscore" class="space-y-2 text-left">
                        <!-- High scores injected here -->
                    </ul>
                </div>
            </div>
        </div>

        <!-- SCREEN: GAME -->
        <div id="screen-game" class="glass-card p-6 text-center hidden relative animate-pop min-h-[500px] flex flex-col">
            <!-- Progress Bar -->
            <div class="w-full bg-white/50 rounded-full h-5 mb-6 relative overflow-hidden shadow-inner p-1">
                <div id="progress-bar" class="bg-gradient-to-r from-pastelGreen to-green-400 h-3 rounded-full transition-all duration-700 ease-out shadow-sm" style="width: 0%"></div>
            </div>

            <div class="flex justify-between items-center mb-2 px-2">
                <div class="bg-white/50 px-3 py-1 rounded-full text-slate-500 text-sm font-bold border border-white">
                    ‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà <span id="text-counter">1/10</span>
                </div>
                <div class="bg-indigo-100/80 px-3 py-1 rounded-full text-indigo-600 font-bold text-sm border border-indigo-200">
                    ‚≠ê <span id="text-score">0</span>
                </div>
            </div>

            <!-- Image Area (Inline SVG) -->
            <div class="relative group">
                <div id="container-image" class="w-48 h-48 mx-auto mb-4 bg-white/50 rounded-[2rem] p-4 shadow-sm border-4 border-white flex items-center justify-center transform group-hover:scale-105 transition-transform duration-300">
                    <!-- SVG injected via JS -->
                </div>
                <!-- Speaker Button Overlay -->
                <button id="btn-speak-word" class="absolute -bottom-2 right-1/4 bg-yellow-300 hover:bg-yellow-400 text-yellow-800 p-3 rounded-full shadow-lg transition transform hover:rotate-12 hover:scale-110 border-4 border-white" title="‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                    </svg>
                </button>
            </div>

            <!-- Hint Area -->
            <div class="mb-6 h-8 flex justify-center items-center">
                <button id="btn-hint" class="flex items-center gap-1 text-sm bg-indigo-100 text-indigo-500 px-4 py-1.5 rounded-full hover:bg-indigo-200 transition font-bold shadow-sm">
                    üí° ‡∏Ç‡∏≠‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ (‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏î‡∏≤‡∏ß‡∏ô‡∏∞)
                </button>
                <div id="container-hint" class="hidden text-slate-600 font-bold text-lg bg-yellow-100/80 px-4 py-1 rounded-lg border border-yellow-200 animate-pop"></div>
            </div>

            <!-- Input Area -->
            <form id="form-answer" class="mt-auto">
                <input type="text" id="input-answer" autocomplete="off" class="w-full text-center text-3xl font-head tracking-widest bg-white/70 border-2 border-indigo-100 rounded-2xl py-4 px-4 focus:outline-none focus:border-indigo-400 focus:bg-white text-indigo-600 placeholder-indigo-200 transition shadow-sm" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö...">
                
                <button type="submit" class="mt-4 w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-4 rounded-2xl shadow-lg hover:shadow-indigo-500/30 transition transform active:scale-95 text-xl flex items-center justify-center gap-2">
                    <span>‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</span> üöÄ
                </button>
            </form>
        </div>

        <!-- SCREEN: FEEDBACK MODAL -->
        <div id="modal-feedback" class="fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm hidden p-4 opacity-0 transition-opacity duration-300">
            <div class="glass-card w-full max-w-sm p-6 text-center bg-white relative transform scale-95 transition-transform duration-300" id="feedback-content">
                <div id="feedback-icon" class="text-7xl mb-2 animate-bounce-slow inline-block">üéâ</div>
                <h2 id="feedback-title" class="text-3xl font-head font-bold mb-2 text-indigo-600"></h2>
                
                <div class="bg-indigo-50/80 rounded-2xl p-5 my-4 border border-indigo-100">
                    <p class="text-3xl font-bold text-slate-700 mb-1 tracking-wide" id="feedback-word"></p>
                    <p class="text-lg text-slate-500 mb-4" id="feedback-meaning"></p>
                    <div class="h-px bg-indigo-200 mb-4 w-3/4 mx-auto"></div>
                    <div class="flex flex-col items-center justify-center gap-2">
                         <div class="flex items-center gap-2">
                             <button id="btn-speak-sentence" class="bg-white p-2 rounded-full text-indigo-500 hover:text-indigo-700 shadow-sm border border-indigo-100 hover:bg-indigo-50 transition">
                                 <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                                </svg>
                            </button>
                            <p class="text-xs text-slate-400 font-bold uppercase tracking-wider">Example</p>
                         </div>
                        <div class="text-center">
                            <p id="feedback-sentence" class="text-slate-800 font-medium italic text-lg"></p>
                            <p id="feedback-sentence-trans" class="text-sm text-slate-500 mt-1"></p>
                        </div>
                    </div>
                </div>

                <button id="btn-next" class="w-full bg-green-400 hover:bg-green-500 text-white font-bold py-3 rounded-xl shadow-lg shadow-green-400/30 text-xl transition transform hover:-translate-y-1">
                    ‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡πÑ‡∏õ ‚û°Ô∏è
                </button>
            </div>
        </div>

        <!-- SCREEN: CONFIRM HOME MODAL -->
        <div id="modal-confirm" class="fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm hidden p-4">
             <div class="glass-card w-full max-w-sm p-6 text-center bg-white animate-pop">
                <div class="text-5xl mb-4">üè†</div>
                <h3 class="text-2xl font-bold text-slate-700 mb-2">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å?</h3>
                <p class="text-slate-500 mb-6">‡∏ñ‡πâ‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ ‡πÄ‡∏Å‡∏°‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà‡∏ô‡∏∞‡∏à‡πä‡∏∞</p>
                <div class="flex gap-3">
                    <button id="btn-cancel-home" class="flex-1 bg-white border-2 border-slate-200 text-slate-500 font-bold py-2 rounded-xl hover:bg-slate-50">
                        ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡πà‡∏≠
                    </button>
                    <button id="btn-confirm-home" class="flex-1 bg-pink-400 text-white font-bold py-2 rounded-xl hover:bg-pink-500 shadow-md">
                        ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å
                    </button>
                </div>
             </div>
        </div>

        <!-- SCREEN: END -->
        <div id="screen-end" class="glass-card p-8 text-center hidden animate-pop">
            <h2 class="text-4xl font-head font-bold text-indigo-600 mb-6">‡∏à‡∏ö‡πÄ‡∏Å‡∏°‡πÅ‡∏•‡πâ‡∏ß!</h2>
            
            <div id="container-stars" class="flex justify-center gap-3 mb-6 text-6xl drop-shadow-md filter">
                <!-- Stars JS -->
            </div>

            <div class="bg-white/50 rounded-2xl p-6 mb-8 border border-white">
                <p id="text-praise" class="text-2xl font-bold text-pink-500 mb-2"></p>
                <div class="flex justify-center items-end gap-2 text-slate-600">
                    <span>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°</span>
                    <span id="text-final-score" class="font-bold text-indigo-600 text-5xl leading-none">0</span>
                    <span>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</span>
                </div>
            </div>

            <div class="space-y-3">
                <button id="btn-restart" class="w-full bg-indigo-500 text-white font-bold py-3.5 rounded-full hover:bg-indigo-600 transition shadow-lg hover:shadow-indigo-500/30 flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                    ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                </button>
                <button id="btn-end-home" class="w-full bg-white/80 border-2 border-indigo-200 text-indigo-500 font-bold py-3.5 rounded-full hover:bg-indigo-50 transition">
                    ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
                </button>
            </div>
        </div>

    </div>

    <script>
        /**
         * Configuration & Constants
         */
        const Config = {
            STORAGE_KEY: 'spellingGameScores',
            ANIMATION_DELAY: 300,
            POINTS_PER_QUESTION: 10,
            MAX_HIGHSCORES: 5,
            TTS: {
                LANG: 'en-US',
                RATE: 0.8,
                PITCH: 1.1
            }
        };

        /**
         * SVG Assets Library
         */
        const SVGs = {
            ferris_wheel: `<svg viewBox="0 0 200 200"><circle cx="100" cy="90" r="70" stroke="#FF80AB" stroke-width="8" fill="none"/><path d="M100 90 L100 20 M100 90 L160 55 M100 90 L160 125 M100 90 L100 160 M100 90 L40 125 M100 90 L40 55" stroke="#FFD1DC" stroke-width="4"/><circle cx="100" cy="90" r="10" fill="#FDFD96"/><path d="M70 160 L100 90 L130 160" stroke="#AEC6CF" stroke-width="8" fill="none" stroke-linecap="round"/><rect x="90" y="10" width="20" height="20" rx="5" fill="#B5EAD7"/><rect x="150" y="45" width="20" height="20" rx="5" fill="#E0BBE4"/><rect x="150" y="115" width="20" height="20" rx="5" fill="#FF80AB"/><rect x="90" y="150" width="20" height="20" rx="5" fill="#B5EAD7"/><rect x="30" y="115" width="20" height="20" rx="5" fill="#E0BBE4"/><rect x="30" y="45" width="20" height="20" rx="5" fill="#FF80AB"/></svg>`,
            city: `<svg viewBox="0 0 200 200"><rect x="40" y="80" width="40" height="100" fill="#AEC6CF" rx="5"/><rect x="90" y="40" width="50" height="140" fill="#E0BBE4" rx="5"/><rect x="150" y="100" width="30" height="80" fill="#FFD1DC" rx="5"/><rect x="50" y="90" width="10" height="10" fill="white"/><rect x="50" y="110" width="10" height="10" fill="white"/><rect x="100" y="60" width="10" height="10" fill="white"/><rect x="120" y="60" width="10" height="10" fill="white"/><rect x="100" y="80" width="10" height="10" fill="white"/><rect x="120" y="80" width="10" height="10" fill="white"/><circle cx="170" cy="30" r="15" fill="#FDFD96" opacity="0.8"/></svg>`,
            countryside: `<svg viewBox="0 0 200 200"><circle cx="160" cy="40" r="20" fill="#FDFD96"/><path d="M0 150 Q50 100 100 150 T200 150 V200 H0 Z" fill="#B5EAD7"/><path d="M-20 180 Q60 140 140 180 T300 180 V200 H-20 Z" fill="#90EE90"/><rect x="40" y="110" width="40" height="40" fill="#FFD1DC" stroke="#A88884" stroke-width="2"/><path d="M35 110 L60 85 L85 110 Z" fill="#FF80AB"/><rect x="55" y="130" width="10" height="20" fill="#A88884" rx="2"/><circle cx="150" cy="130" r="15" fill="#81C784"/><rect x="148" y="145" width="4" height="20" fill="#8D6E63"/></svg>`,
            tomorrow: `<svg viewBox="0 0 200 200"><rect x="40" y="50" width="120" height="120" rx="15" fill="white" stroke="#AEC6CF" stroke-width="4"/><rect x="40" y="50" width="120" height="40" rx="15" fill="#FF80AB"/><text x="100" y="80" font-family="Mali" font-size="20" fill="white" text-anchor="middle">NEXT DAY</text><text x="100" y="140" font-family="Itim" font-size="60" fill="#333" text-anchor="middle">‚òÄÔ∏è</text><path d="M140 120 L170 120 L155 135" stroke="#333" stroke-width="4" stroke-linecap="round" fill="none"/></svg>`,
            yesterday: `<svg viewBox="0 0 200 200"><circle cx="100" cy="100" r="70" fill="#E0BBE4" stroke="white" stroke-width="5"/><circle cx="100" cy="100" r="5" fill="#333"/><path d="M100 100 L100 50" stroke="#333" stroke-width="5" stroke-linecap="round"/><path d="M100 100 L60 100" stroke="#333" stroke-width="5" stroke-linecap="round"/><path d="M100 40 Q60 40 40 70 L30 60 M40 70 L55 70" stroke="#FF80AB" stroke-width="4" fill="none" stroke-linecap="round"/></svg>`,
            penguin: `<svg viewBox="0 0 200 200"><ellipse cx="100" cy="110" rx="50" ry="70" fill="#37474F"/><ellipse cx="100" cy="115" rx="35" ry="55" fill="white"/><circle cx="85" cy="90" r="5" fill="#333"/><circle cx="115" cy="90" r="5" fill="#333"/><path d="M95 100 L105 100 L100 110 Z" fill="#FFB74D"/><path d="M60 130 Q50 150 70 170" stroke="#FFB74D" stroke-width="8" stroke-linecap="round"/><path d="M140 130 Q150 150 130 170" stroke="#FFB74D" stroke-width="8" stroke-linecap="round"/></svg>`,
            octopus: `<svg viewBox="0 0 200 200"><circle cx="100" cy="90" r="50" fill="#FFD1DC"/><circle cx="85" cy="85" r="8" fill="white"/><circle cx="115" cy="85" r="8" fill="white"/><circle cx="85" cy="85" r="3" fill="#333"/><circle cx="115" cy="85" r="3" fill="#333"/><path d="M95 100 Q100 105 105 100" stroke="#333" stroke-width="2" fill="none"/><path d="M60 120 Q50 160 70 150 T90 150" fill="none" stroke="#FFD1DC" stroke-width="15" stroke-linecap="round"/><path d="M140 120 Q150 160 130 150 T110 150" fill="none" stroke="#FFD1DC" stroke-width="15" stroke-linecap="round"/><path d="M55 100 Q30 120 50 130" fill="none" stroke="#FFD1DC" stroke-width="15" stroke-linecap="round"/><path d="M145 100 Q170 120 150 130" fill="none" stroke="#FFD1DC" stroke-width="15" stroke-linecap="round"/></svg>`,
            turtle: `<svg viewBox="0 0 200 200"><ellipse cx="100" cy="110" rx="60" ry="45" fill="#B5EAD7"/><path d="M70 110 Q100 60 130 110" fill="#81C784" stroke="#66BB6A" stroke-width="2"/><circle cx="160" cy="110" r="25" fill="#B5EAD7"/><circle cx="165" cy="105" r="3" fill="#333"/><path d="M60 145 L50 165" stroke="#B5EAD7" stroke-width="12" stroke-linecap="round"/><path d="M140 145 L150 165" stroke="#B5EAD7" stroke-width="12" stroke-linecap="round"/><path d="M40 110 L30 120" stroke="#B5EAD7" stroke-width="8" stroke-linecap="round"/></svg>`,
            dolphin: `<svg viewBox="0 0 200 200"><path d="M160 100 Q140 60 80 80 Q40 90 40 120 Q60 130 100 110" fill="#AEC6CF"/><circle cx="70" cy="95" r="3" fill="#333"/><path d="M100 80 L90 60 L110 75" fill="#AEC6CF"/><path d="M100 110 L110 130 L120 115" fill="#AEC6CF"/><path d="M160 100 Q180 100 170 80 M160 100 Q180 110 170 130" stroke="#AEC6CF" stroke-width="5" fill="none"/></svg>`,
            alligator: `<svg viewBox="0 0 200 200"><rect x="40" y="100" width="120" height="40" rx="10" fill="#B5EAD7"/><path d="M40 100 L30 120 L50 120 Z" fill="#81C784"/><path d="M160 100 Q190 110 190 130 L160 140" fill="#B5EAD7"/><circle cx="170" cy="115" r="5" fill="white"/><circle cx="172" cy="115" r="2" fill="#333"/><path d="M60 140 L60 155" stroke="#B5EAD7" stroke-width="10" stroke-linecap="round"/><path d="M140 140 L140 155" stroke="#B5EAD7" stroke-width="10" stroke-linecap="round"/><path d="M40 100 L50 90 L60 100 L70 90 L80 100 L90 90 L100 100" fill="none" stroke="#81C784" stroke-width="3"/></svg>`
        };

        /**
         * Vocabulary Data
         */
        const VocabData = [
            { word: 'ferris wheel', meaning: '‡∏ä‡∏¥‡∏á‡∏ä‡πâ‡∏≤‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå', hint: '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏ô‡∏™‡∏ß‡∏ô‡∏™‡∏ô‡∏∏‡∏Å ‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏™‡∏π‡∏á‡πÜ', sentence: 'We see the big ferris wheel.', sentenceTrans: '‡∏û‡∏ß‡∏Å‡πÄ‡∏£‡∏≤‡πÄ‡∏´‡πá‡∏ô‡∏ä‡∏¥‡∏á‡∏ä‡πâ‡∏≤‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå‡∏≠‡∏±‡∏ô‡πÉ‡∏´‡∏ç‡πà', svg: SVGs.ferris_wheel },
            { word: 'city', meaning: '‡πÄ‡∏°‡∏∑‡∏≠‡∏á', hint: '‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ï‡∏∂‡∏Å‡πÄ‡∏¢‡∏≠‡∏∞‡πÜ ‡πÅ‡∏•‡∏∞‡∏£‡∏ñ‡∏°‡∏≤‡∏Å‡∏°‡∏≤‡∏¢', sentence: 'The city is very busy.', sentenceTrans: '‡πÉ‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ß‡∏∏‡πà‡∏ô‡∏ß‡∏≤‡∏¢‡∏°‡∏≤‡∏Å', svg: SVGs.city },
            { word: 'countryside', meaning: '‡∏ä‡∏ô‡∏ö‡∏ó', hint: '‡∏ô‡∏≠‡∏Å‡πÄ‡∏°‡∏∑‡∏≠‡∏á ‡∏°‡∏µ‡∏ó‡∏∏‡πà‡∏á‡∏ô‡∏≤‡πÅ‡∏•‡∏∞‡∏†‡∏π‡πÄ‡∏Ç‡∏≤', sentence: 'Grandma lives in the countryside.', sentenceTrans: '‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏≤‡∏¢‡∏≠‡∏≤‡∏®‡∏±‡∏¢‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡∏ô‡∏ö‡∏ó', svg: SVGs.countryside },
            { word: 'tomorrow', meaning: '‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ', hint: '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πà‡∏≠‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ', sentence: 'I will go to school tomorrow.', sentenceTrans: '‡∏â‡∏±‡∏ô‡∏à‡∏∞‡πÑ‡∏õ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ', svg: SVGs.tomorrow },
            { word: 'yesterday', meaning: '‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô', hint: '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß', sentence: 'Yesterday was Sunday.', sentenceTrans: '‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå', svg: SVGs.yesterday },
            { word: 'penguin', meaning: '‡∏ô‡∏Å‡πÄ‡∏û‡∏ô‡∏Å‡∏ß‡∏¥‡∏ô', hint: '‡∏ô‡∏Å‡∏ï‡∏±‡∏ß‡∏™‡∏µ‡∏î‡∏≥‡∏Ç‡∏≤‡∏ß ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏´‡∏ô‡∏≤‡∏ß‡πÜ ‡πÄ‡∏î‡∏¥‡∏ô‡∏ï‡πâ‡∏ß‡∏°‡πÄ‡∏ï‡∏µ‡πâ‡∏¢‡∏°', sentence: 'The penguin loves the ice.', sentenceTrans: '‡∏ô‡∏Å‡πÄ‡∏û‡∏ô‡∏Å‡∏ß‡∏¥‡∏ô‡∏ä‡∏≠‡∏ö‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á', svg: SVGs.penguin },
            { word: 'octopus', meaning: '‡∏õ‡∏•‡∏≤‡∏´‡∏°‡∏∂‡∏Å‡∏¢‡∏±‡∏Å‡∏©‡πå', hint: '‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏ó‡∏∞‡πÄ‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏µ 8 ‡∏´‡∏ô‡∏ß‡∏î', sentence: 'An octopus has eight legs.', sentenceTrans: '‡∏õ‡∏•‡∏≤‡∏´‡∏°‡∏∂‡∏Å‡∏¢‡∏±‡∏Å‡∏©‡πå‡∏°‡∏µ 8 ‡∏Ç‡∏≤', svg: SVGs.octopus },
            { word: 'turtle', meaning: '‡πÄ‡∏ï‡πà‡∏≤', hint: '‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏£‡∏∞‡∏î‡∏≠‡∏á‡πÅ‡∏Ç‡πá‡∏á ‡πÄ‡∏î‡∏¥‡∏ô‡∏ä‡πâ‡∏≤', sentence: 'The turtle walks slowly.', sentenceTrans: '‡πÄ‡∏ï‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ä‡πâ‡∏≤‡πÜ', svg: SVGs.turtle },
            { word: 'dolphin', meaning: '‡πÇ‡∏•‡∏°‡∏≤', hint: '‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏•‡∏π‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏°‡πÉ‡∏ô‡∏ó‡∏∞‡πÄ‡∏• ‡∏â‡∏•‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏Ç‡∏µ‡πâ‡πÄ‡∏•‡πà‡∏ô', sentence: 'Dolphins can jump high.', sentenceTrans: '‡πÇ‡∏•‡∏°‡∏≤‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á', svg: SVGs.dolphin },
            { word: 'alligator', meaning: '‡∏à‡∏£‡∏∞‡πÄ‡∏Ç‡πâ', hint: '‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏∑‡πâ‡∏≠‡∏¢‡∏Ñ‡∏•‡∏≤‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß ‡∏ü‡∏±‡∏ô‡πÅ‡∏´‡∏•‡∏° ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ô‡πâ‡∏≥', sentence: 'Be careful of the alligator!', sentenceTrans: '‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏à‡∏£‡∏∞‡πÄ‡∏Ç‡πâ‡∏ô‡∏∞!', svg: SVGs.alligator }
        ];

        /**
         * Service: Audio Controller
         * Handles Speech Synthesis
         */
        const AudioService = {
            speak(text) {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = Config.TTS.LANG;
                    utterance.rate = Config.TTS.RATE;
                    utterance.pitch = Config.TTS.PITCH;
                    window.speechSynthesis.speak(utterance);
                }
            }
        };

        /**
         * Service: Storage
         * Handles LocalStorage operations
         */
        const StorageService = {
            getHighScores() {
                try {
                    return JSON.parse(localStorage.getItem(Config.STORAGE_KEY)) || [];
                } catch {
                    return [];
                }
            },
            
            saveScore(name, score) {
                try {
                    let scores = this.getHighScores();
                    scores.push({ name, score });
                    scores.sort((a, b) => b.score - a.score);
                    scores = scores.slice(0, Config.MAX_HIGHSCORES);
                    localStorage.setItem(Config.STORAGE_KEY, JSON.stringify(scores));
                } catch(e) {
                    console.error("Storage save failed", e);
                }
            }
        };

        /**
         * Controller: UI
         * Handles DOM updates and Events
         */
        const UI = {
            Elements: {
                screens: ['screen-home', 'screen-game', 'screen-end'],
                inputs: {
                    name: document.getElementById('input-player-name'),
                    answer: document.getElementById('input-answer')
                },
                displays: {
                    image: document.getElementById('container-image'),
                    hint: document.getElementById('container-hint'),
                    stars: document.getElementById('container-stars'),
                    highscores: document.getElementById('list-highscore'),
                    toast: document.getElementById('toast'),
                    progressBar: document.getElementById('progress-bar')
                },
                text: {
                    counter: document.getElementById('text-counter'),
                    score: document.getElementById('text-score'),
                    praise: document.getElementById('text-praise'),
                    finalScore: document.getElementById('text-final-score')
                },
                modals: {
                    feedback: document.getElementById('modal-feedback'),
                    confirm: document.getElementById('modal-confirm')
                },
                buttons: {
                    home: document.getElementById('btn-home'),
                    hint: document.getElementById('btn-hint'),
                    next: document.getElementById('btn-next')
                }
            },

            showScreen(screenId) {
                this.Elements.screens.forEach(id => {
                    document.getElementById(id).classList.add('hidden');
                });
                document.getElementById(screenId).classList.remove('hidden');
                
                // Toggle Home Button
                if (screenId === 'screen-home') {
                    this.Elements.buttons.home.classList.add('hidden');
                } else {
                    this.Elements.buttons.home.classList.remove('hidden');
                }
            },

            showToast() {
                const toast = this.Elements.displays.toast;
                toast.classList.remove('opacity-0');
                toast.classList.add('opacity-100', 'animate-bounce');
                setTimeout(() => {
                    toast.classList.remove('opacity-100', 'animate-bounce');
                    toast.classList.add('opacity-0');
                }, 2000);
            },

            renderHighScores(scores) {
                const list = this.Elements.displays.highscores;
                if (scores.length === 0) {
                    list.innerHTML = `<li class="text-center text-slate-400 text-sm py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ô‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏•‡∏¢ ‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡πÅ‡∏£‡∏Å‡∏Å‡∏±‡∏ô‡πÄ‡∏ñ‡∏≠‡∏∞!</li>`;
                    return;
                }
                list.innerHTML = scores.map((s, i) => {
                    const medals = ['ü•á', 'ü•à', 'ü•â'];
                    const rank = medals[i] || `${i+1}.`;
                    return `
                        <li class="flex justify-between items-center bg-white/60 p-3 rounded-lg text-sm shadow-sm mb-1">
                            <span class="font-bold text-slate-600 truncate max-w-[120px]">${rank} ${s.name}</span>
                            <span class="font-bold text-indigo-500 bg-indigo-50 px-2 py-1 rounded-md">${s.score} pts</span>
                        </li>`;
                }).join('');
            },

            resetInput() {
                const input = this.Elements.inputs.answer;
                input.value = '';
                input.classList.remove('border-red-400', 'bg-red-50', 'text-red-500', 'animate-shake');
                input.classList.add('border-indigo-100', 'bg-white/70', 'text-indigo-600');
                
                // Reset Hint
                this.Elements.displays.hint.classList.add('hidden');
                this.Elements.buttons.hint.classList.remove('hidden');
                
                // Focus input
                setTimeout(() => input.focus(), 300);
            },

            showInputError() {
                const input = this.Elements.inputs.answer;
                input.classList.add('animate-shake', 'border-red-400', 'bg-red-50', 'text-red-500');
                setTimeout(() => input.classList.remove('animate-shake'), 500);
            },

            updateGameInfo(current, total, score) {
                this.Elements.text.counter.innerText = `${current}/${total}`;
                this.Elements.text.score.innerText = `${score}`;
                const percent = ((current - 1) / total) * 100;
                this.Elements.displays.progressBar.style.width = `${percent}%`;
            },

            renderQuestion(question) {
                this.Elements.displays.image.innerHTML = question.svg;
            },

            showFeedback(isCorrect, points, questionData, onNext) {
                const modal = this.Elements.modals.feedback;
                const { title, icon, word, meaning, sentence, sentenceTrans } = {
                    title: document.getElementById('feedback-title'),
                    icon: document.getElementById('feedback-icon'),
                    word: document.getElementById('feedback-word'),
                    meaning: document.getElementById('feedback-meaning'),
                    sentence: document.getElementById('feedback-sentence'),
                    sentenceTrans: document.getElementById('feedback-sentence-trans')
                };

                modal.classList.remove('hidden');
                void modal.offsetWidth; // Trigger reflow
                modal.classList.remove('opacity-0');

                // Set Content
                if (isCorrect) {
                    icon.innerText = points > 0 ? 'üåü' : 'üòÖ';
                    title.innerText = points > 0 ? '‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å!' : '‡∏ñ‡∏π‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡∏à‡πâ‡∏≤ (‡πÅ‡∏ï‡πà‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ)';
                    title.className = "text-3xl font-head font-bold mb-2 " + (points > 0 ? "text-green-500" : "text-yellow-500");
                    this.Elements.buttons.next.className = "w-full bg-green-400 hover:bg-green-500 text-white font-bold py-3 rounded-xl shadow-lg shadow-green-400/30 text-xl transition transform hover:-translate-y-1";
                } else {
                    icon.innerText = '‚ùå';
                    title.innerText = '‡πÄ‡∏â‡∏•‡∏¢‡∏à‡πâ‡∏≤';
                    title.className = "text-3xl font-head font-bold mb-2 text-pink-500";
                    this.Elements.buttons.next.className = "w-full bg-pink-400 hover:bg-pink-500 text-white font-bold py-3 rounded-xl shadow-lg shadow-pink-400/30 text-xl transition transform hover:-translate-y-1";
                }

                word.innerText = questionData.word;
                meaning.innerText = questionData.meaning;
                sentence.innerText = `"${questionData.sentence}"`;
                sentenceTrans.innerText = questionData.sentenceTrans;

                // Bind Next Button
                this.Elements.buttons.next.onclick = () => {
                     modal.classList.add('opacity-0');
                     setTimeout(() => {
                         modal.classList.add('hidden');
                         onNext();
                     }, 300);
                };
                
                setTimeout(() => this.Elements.buttons.next.focus(), 100);
            },

            renderEndScreen(score, totalQuestions) {
                const maxScore = totalQuestions * Config.POINTS_PER_QUESTION;
                const percentage = (score / maxScore) * 100;
                
                let starsHTML = '';
                let praiseText = '';

                if (percentage === 100) {
                    starsHTML = '<span class="text-yellow-400">‚≠ê‚≠ê‚≠ê</span>';
                    praiseText = '‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î! ‡πÄ‡∏ó‡∏û‡∏°‡∏≤‡∏Å!';
                } else if (percentage >= 70) {
                    starsHTML = '<span class="text-yellow-400">‚≠ê‚≠ê</span><span class="text-gray-300 opacity-50">‚≠ê</span>';
                    praiseText = '‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å! ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î‡∏ô‡∏∞';
                } else {
                    starsHTML = '<span class="text-yellow-400">‚≠ê</span><span class="text-gray-300 opacity-50">‚≠ê‚≠ê</span>';
                    praiseText = '‡∏™‡∏π‡πâ‡πÜ ‡∏ô‡∏∞ ‡∏ù‡∏∂‡∏Å‡∏ù‡∏ô‡∏ö‡πà‡∏≠‡∏¢‡πÜ ‡πÄ‡∏Å‡πà‡∏á‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô';
                }

                this.Elements.displays.stars.innerHTML = starsHTML;
                this.Elements.text.praise.innerText = praiseText;
                
                // Animate Score
                const scoreEl = this.Elements.text.finalScore;
                let current = 0;
                const interval = setInterval(() => {
                    if (current >= score) {
                        clearInterval(interval);
                        scoreEl.innerText = score;
                    } else {
                        current++;
                        scoreEl.innerText = current;
                    }
                }, 40);
            }
        };

        /**
         * Game Engine
         * Main Game Logic
         */
        const GameEngine = {
            state: {
                playerName: '',
                questions: [],
                currentIndex: 0,
                score: 0,
                isHintUsed: false
            },

            init() {
                this.bindEvents();
                this.loadHome();
            },

            bindEvents() {
                // Home Screen
                document.getElementById('btn-start').onclick = () => this.start();
                
                // Game Screen
                document.getElementById('btn-home').onclick = () => document.getElementById('modal-confirm').classList.remove('hidden');
                document.getElementById('form-answer').onsubmit = (e) => {
                    e.preventDefault();
                    this.checkAnswer();
                };
                document.getElementById('btn-speak-word').onclick = () => this.speakCurrentWord();
                document.getElementById('btn-hint').onclick = () => this.useHint();
                
                // Feedback Modal
                document.getElementById('btn-speak-sentence').onclick = () => this.speakCurrentSentence();

                // Confirm Modal
                document.getElementById('btn-cancel-home').onclick = () => document.getElementById('modal-confirm').classList.add('hidden');
                document.getElementById('btn-confirm-home').onclick = () => this.quitToHome();

                // End Screen
                document.getElementById('btn-restart').onclick = () => this.start();
                document.getElementById('btn-end-home').onclick = () => this.quitToHome();
            },

            loadHome() {
                const scores = StorageService.getHighScores();
                UI.renderHighScores(scores);
                UI.showScreen('screen-home');
                UI.Elements.inputs.name.value = '';
            },

            shuffleQuestions() {
                let array = [...VocabData];
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            },

            start() {
                const name = UI.Elements.inputs.name.value.trim();
                if (!name) {
                    UI.showToast();
                    UI.Elements.inputs.name.focus();
                    return;
                }

                this.state.playerName = name;
                this.state.questions = this.shuffleQuestions();
                this.state.currentIndex = 0;
                this.state.score = 0;

                UI.showScreen('screen-game');
                this.loadQuestion();
            },

            loadQuestion() {
                const q = this.state.questions[this.state.currentIndex];
                this.state.isHintUsed = false;

                UI.resetInput();
                UI.updateGameInfo(this.state.currentIndex + 1, this.state.questions.length, this.state.score);
                UI.renderQuestion(q);
                
                // Auto speak with slight delay
                setTimeout(() => AudioService.speak(q.word), 600);
            },

            checkAnswer() {
                const inputVal = UI.Elements.inputs.answer.value.trim().toLowerCase();
                if (!inputVal) return;

                const currentQ = this.state.questions[this.state.currentIndex];
                const isCorrect = inputVal === currentQ.word.toLowerCase();

                if (isCorrect) {
                    const points = this.state.isHintUsed ? 0 : Config.POINTS_PER_QUESTION;
                    this.state.score += points;
                    
                    // Audio Feedback
                    if (points > 0) setTimeout(() => AudioService.speak("Excellent!"), 200);

                    UI.showFeedback(true, points, currentQ, () => this.nextQuestion());
                } else {
                    UI.showInputError();
                    
                    // Audio Feedback
                    setTimeout(() => AudioService.speak("Nice try!"), 200);

                    UI.showFeedback(false, 0, currentQ, () => this.nextQuestion());
                }
            },

            useHint() {
                const q = this.state.questions[this.state.currentIndex];
                this.state.isHintUsed = true;
                const hintHTML = `<span class="text-pink-500 font-bold text-2xl">${q.word.charAt(0).toUpperCase()}...</span> <span class="text-sm font-normal">(${q.hint})</span>`;
                
                const hintEl = document.getElementById('container-hint');
                const btnEl = document.getElementById('btn-hint');
                hintEl.innerHTML = hintHTML;
                hintEl.classList.remove('hidden');
                btnEl.classList.add('hidden');
            },

            nextQuestion() {
                this.state.currentIndex++;
                if (this.state.currentIndex >= this.state.questions.length) {
                    this.endGame();
                } else {
                    this.loadQuestion();
                }
            },

            speakCurrentWord() {
                const q = this.state.questions[this.state.currentIndex];
                AudioService.speak(q.word);
            },

            speakCurrentSentence() {
                const q = this.state.questions[this.state.currentIndex];
                AudioService.speak(q.sentence);
            },

            endGame() {
                StorageService.saveScore(this.state.playerName, this.state.score);
                UI.showScreen('screen-end');
                UI.renderEndScreen(this.state.score, this.state.questions.length);
            },

            quitToHome() {
                document.getElementById('modal-confirm').classList.add('hidden');
                this.loadHome();
            }
        };

        // Initialize
        window.onload = () => GameEngine.init();

    </script>
</body>
</html>
