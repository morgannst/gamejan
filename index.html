<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>เกมทายศัพท์อังกฤษแสนสนุก</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Itim&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Itim', cursive;
            background: linear-gradient(135deg, #fce7f3, #e9d5ff);
        }
        .card {
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
        }
        .btn {
            color: white;
            transition: all 0.2s ease;
            border: none;
            cursor: pointer;
            border-radius: 16px;
            padding: 14px 28px;
            font-size: 1.3rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .btn:hover {
            transform: translateY(-2px);
            filter: brightness(1.05);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }
        .btn:active {
            transform: translateY(1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: translateY(0);
        }
        .btn-pink { background-color: #f472b6; }
        .btn-purple { background-color: #c084fc; }
        .btn-green { background-color: #34d399; }
        .btn-blue { background-color: #60a5fa; }

        .correct-animation { animation: correct 0.5s ease-in-out; }
        @keyframes correct {
            50% { transform: scale(1.1); color: #10b981; }
        }
        .incorrect-animation { animation: incorrect 0.5s ease-in-out; }
        @keyframes incorrect {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        .svg-icon {
            width: 100%; height: 100%; max-width: 180px; max-height: 180px;
            margin: auto; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.08));
        }
        #confetti-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 100;
        }
        #score-container {
            position: absolute; top: 16px; right: 16px;
            display: flex; align-items: center; justify-content: center;
            color: #ec4899;
        }
        #score-heart {
            width: 70px; height: 70px;
            position: absolute; z-index: 1;
            fill: #fdf2f8;
            stroke: #fce7f3;
            stroke-width: 2px;
        }
        #score {
            position: relative; z-index: 2; font-size: 1.5rem;
            font-weight: bold;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4 text-gray-700">

    <div id="start-container" class="card w-full max-w-md p-8 rounded-2xl text-center">
        <h1 class="text-5xl font-bold text-pink-500 mb-4">เกมทายศัพท์แสนสนุก</h1>
        <h2 class="text-2xl mb-8">เลือกระดับความยากได้เลยจ้า</h2>
        <div class="flex flex-col gap-4">
            <button id="easy-btn" class="btn btn-green">ง่าย (มีรูปภาพ)</button>
            <button id="hard-btn" class="btn btn-blue">ยาก (ไม่มีรูปภาพ)</button>
        </div>
    </div>

    <div id="game-container" class="hidden card w-full max-w-md p-6 rounded-2xl text-center relative">
        <button id="back-button" title="กลับหน้าหลัก" class="absolute top-4 left-4 btn btn-purple !p-2 !rounded-full shadow-lg">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
        </button>
        <div id="score-container">
            <svg id="score-heart" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
            <span id="score">0</span>
        </div>
        <h1 class="text-4xl font-bold text-pink-500 mb-2 mt-16 md:mt-0">ทายคำศัพท์กัน!</h1>
        <p id="progress-text" class="text-lg mb-4">คำที่ 1 จาก 10</p>
        <div id="image-container" class="h-48 w-full mb-4 flex items-center justify-center"></div>
        <button id="speak-button" class="btn btn-purple inline-flex items-center gap-2 mb-4 !py-2 !px-4 !text-lg">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>
            ฟังคำใบ้
        </button>
        <div class="flex flex-col sm:flex-row gap-3">
            <input type="text" id="answer-input" placeholder="พิมพ์คำตอบที่นี่..." class="flex-grow p-3 border-2 border-pink-200 rounded-xl focus:ring-2 focus:ring-pink-400 focus:outline-none transition text-xl">
            <button id="submit-button" class="btn btn-pink">ส่งคำตอบ</button>
        </div>
        <div class="mt-4 h-12 flex items-center justify-center gap-2">
            <div id="mascot-container" class="w-10 h-10"></div>
            <p id="feedback-text" class="text-xl font-semibold"></p>
        </div>
    </div>

    <div id="result-container" class="hidden card w-full max-w-md p-8 rounded-2xl text-center">
        <h2 id="result-title" class="text-5xl font-bold text-pink-500 mb-2">จบเกมแล้วจ้า!</h2>
        <p class="text-2xl mb-2">คะแนนรวม: <span id="final-score" class="font-bold"></span></p>
        <p class="text-xl mb-6">ใช้เวลาไป: <span id="total-time" class="font-bold"></span></p>
        <div id="review-section" class="hidden">
            <h3 class="text-3xl font-semibold text-purple-500 mb-4">คำศัพท์ต้องทบทวน</h3>
            <div id="review-list" class="space-y-3 max-h-52 overflow-y-auto p-3 bg-purple-50 rounded-xl"></div>
        </div>
        <button id="restart-button" class="btn btn-pink mt-8 !text-2xl !py-4">เล่นอีกครั้ง</button>
    </div>

    <canvas id="confetti-canvas"></canvas>
    <footer class="mt-8 text-pink-800 text-lg font-semibold opacity-70">
        เกมทายศัพท์อังกฤษแสนสนุก เพื่อพี่แจน โดย พ่อแกน
    </footer>

    <script>
        const vocabGame = {
            data: {
                vocabulary: [
                    { word: 'shapes', svg: '<svg class="svg-icon" viewBox="0 0 100 100"><path d="M50 0 L100 50 L50 100 L0 50 Z" fill="#f87171"/><circle cx="25" cy="25" r="20" fill="#60a5fa"/><rect x="60" y="60" width="30" height="30" fill="#facc15"/></svg>' },
                    { word: 'circle', svg: '<svg class="svg-icon" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="#60a5fa"/></svg>' },
                    { word: 'triangle', svg: '<svg class="svg-icon" viewBox="0 0 100 100"><polygon points="50,10 95,90 5,90" fill="#34d399"/></svg>' },
                    { word: 'square', svg: '<svg class="svg-icon" viewBox="0 0 100 100"><rect x="10" y="10" width="80" height="80" fill="#facc15"/></svg>' },
                    { word: 'rectangle', svg: '<svg class="svg-icon" viewBox="0 0 100 100"><rect x="5" y="25" width="90" height="50" fill="#c084fc"/></svg>' },
                    { word: 'heart', svg: '<svg class="svg-icon" viewBox="0 0 100 100"><path d="M50,90 C-20,40 20,-10 50,25 C80,-10 120,40 50,90" fill="#f472b6"/></svg>' },
                    { word: 'star', svg: '<svg class="svg-icon" viewBox="0 0 100 100"><polygon points="50,5 61,35 95,35 68,57 79,87 50,70 21,87 32,57 5,35 39,35" fill="#fbbf24"/></svg>' },
                    { word: 'row', svg: '<svg class="svg-icon" viewBox="0 0 100 100"><circle cx="15" cy="50" r="10" fill="#a78bfa"/><circle cx="40" cy="50" r="10" fill="#a78bfa"/><circle cx="65" cy="50" r="10" fill="#a78bfa"/><circle cx="90" cy="50" r="10" fill="#a78bfa"/></svg>' },
                    { word: 'column', svg: '<svg class="svg-icon" viewBox="0 0 100 100"><circle cx="50" cy="15" r="10" fill="#7dd3fc"/><circle cx="50" cy="40" r="10" fill="#7dd3fc"/><circle cx="50" cy="65" r="10" fill="#7dd3fc"/><circle cx="50" cy="90" r="10" fill="#7dd3fc"/></svg>' },
                    { word: 'measure', svg: '<svg class="svg-icon" viewBox="0 0 100 30"><rect x="0" y="0" width="100" height="20" fill="#fca5a5"/><line x1="10" y1="0" x2="10" y2="20" stroke="black" /><line x1="20" y1="0" x2="20" y2="15" stroke="black" /><line x1="30" y1="0" x2="30" y2="20" stroke="black" /><line x1="40" y1="0" x2="40" y2="15" stroke="black" /><line x1="50" y1="0" x2="50" y2="20" stroke="black" /><line x1="60" y1="0" x2="60" y2="15" stroke="black" /><line x1="70" y1="0" x2="70" y2="20" stroke="black" /><line x1="80" y1="0" x2="80" y2="15" stroke="black" /><line x1="90" y1="0" x2="90" y2="20" stroke="black" /></svg>' }
                ],
                mascotSVGs: {
                    neutral: '<svg viewBox="0 0 24 24" fill="#fbbf24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1.5 13.5h-3v-3h3v3zm6 0h-3v-3h3v3z"/></svg>',
                    happy: '<svg viewBox="0 0 24 24" fill="#34d399"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.5 14c-1.5 1.5-3.58 2.5-5.99 2.5s-4.5-1-6-2.5c-.25-.25-.25-.66 0-.91.25-.25.66-.25.91 0 1.22.99 2.7 1.66 4.34 1.66s3.12-.67 4.34-1.66c.25-.25.66-.25.91 0 .25.25.25.66 0 .91zM8.5 12c.83 0 1.5-.67 1.5-1.5S9.33 9 8.5 9 7 9.67 7 10.5 7.67 12 8.5 12zm7 0c.83 0 1.5-.67 1.5-1.5S16.33 9 15.5 9 14 9.67 14 10.5s.67 1.5 1.5 1.5z"/></svg>',
                    sad: '<svg viewBox="0 0 24 24" fill="#f87171"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-4.5-9C6.67 11 6 10.33 6 9.5S6.67 8 7.5 8s1.5.67 1.5 1.5S8.33 11 7.5 11zm9 0c-.83 0-1.5-.67-1.5-1.5S15.67 8 16.5 8s1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm-2.01 4c-1.24 1.23-2.99 2-4.99 2s-3.75-.77-5-2c-.25-.25-.25-.66 0-.91s.66-.25.91 0c.98.98 2.24 1.66 3.84 1.66s2.86-.68 3.84-1.66c.25-.25.66-.25.91 0s.25.66 0 .91z" transform="rotate(180 12 12)"/></svg>'
                },
            },
            state: {
                currentWordIndex: 0,
                score: 0,
                difficulty: 'easy',
                incorrectWords: [],
                shuffledVocab: [],
                gameStartTime: null,
                audioContext: null,
                confettiParticles: [],
            },
            dom: {},

            init() {
                this.cacheDom();
                this.bindEvents();
                this.showScreen('start');
            },
            
            cacheDom() {
                this.dom.startContainer = document.getElementById('start-container');
                this.dom.gameContainer = document.getElementById('game-container');
                this.dom.resultContainer = document.getElementById('result-container');
                this.dom.easyBtn = document.getElementById('easy-btn');
                this.dom.hardBtn = document.getElementById('hard-btn');
                this.dom.backButton = document.getElementById('back-button');
                this.dom.imageContainer = document.getElementById('image-container');
                this.dom.speakButton = document.getElementById('speak-button');
                this.dom.answerInput = document.getElementById('answer-input');
                this.dom.submitButton = document.getElementById('submit-button');
                this.dom.feedbackText = document.getElementById('feedback-text');
                this.dom.scoreDisplay = document.getElementById('score');
                this.dom.progressText = document.getElementById('progress-text');
                this.dom.finalScoreDisplay = document.getElementById('final-score');
                this.dom.totalTimeDisplay = document.getElementById('total-time');
                this.dom.reviewSection = document.getElementById('review-section');
                this.dom.reviewList = document.getElementById('review-list');
                this.dom.restartButton = document.getElementById('restart-button');
                this.dom.resultTitle = document.getElementById('result-title');
                this.dom.confettiCanvas = document.getElementById('confetti-canvas');
                this.dom.mascotContainer = document.getElementById('mascot-container');
            },

            bindEvents() {
                this.dom.easyBtn.addEventListener('click', () => this.selectDifficulty('easy'));
                this.dom.hardBtn.addEventListener('click', () => this.selectDifficulty('hard'));
                this.dom.backButton.addEventListener('click', () => this.showScreen('start'));
                this.dom.speakButton.addEventListener('click', () => this.speak(this.state.shuffledVocab[this.state.currentWordIndex].word));
                this.dom.submitButton.addEventListener('click', () => this.checkAnswer());
                this.dom.answerInput.addEventListener('keyup', (event) => {
                    if (event.key === 'Enter') this.checkAnswer();
                });
                this.dom.restartButton.addEventListener('click', () => this.showScreen('start'));
                this.dom.reviewList.addEventListener('click', (event) => {
                    const button = event.target.closest('.review-speak-btn');
                    if (button) this.speak(button.dataset.word);
                });
            },

            showScreen(screenName) {
                this.vfx.stopConfetti();
                this.dom.startContainer.classList.add('hidden');
                this.dom.gameContainer.classList.add('hidden');
                this.dom.resultContainer.classList.add('hidden');
                this.dom[`${screenName}Container`].classList.remove('hidden');
            },

            selectDifficulty(level) {
                this.audio.init();
                this.state.difficulty = level;
                this.showScreen('game');
                this.startGame();
            },

            startGame() {
                this.state.shuffledVocab = [...this.data.vocabulary].sort(() => Math.random() - 0.5);
                this.state.currentWordIndex = 0;
                this.state.score = 0;
                this.state.incorrectWords = [];
                this.state.gameStartTime = new Date(); // เริ่มจับเวลา
                this.dom.scoreDisplay.textContent = this.state.score;
                this.dom.reviewSection.classList.add('hidden');
                this.dom.reviewList.innerHTML = '';
                this.loadNextWord();
            },

            loadNextWord() {
                if (this.state.currentWordIndex < this.state.shuffledVocab.length) {
                    this.ui.setMascot('neutral');
                    const currentWord = this.state.shuffledVocab[this.state.currentWordIndex];
                    this.dom.imageContainer.style.visibility = this.state.difficulty === 'hard' ? 'hidden' : 'visible';
                    this.dom.imageContainer.innerHTML = currentWord.svg;
                    this.dom.answerInput.value = '';
                    this.dom.answerInput.disabled = false;
                    this.dom.submitButton.disabled = false;
                    this.dom.feedbackText.textContent = '';
                    this.dom.feedbackText.className = 'text-xl font-semibold';
                    this.dom.progressText.textContent = `คำที่ ${this.state.currentWordIndex + 1} จาก ${this.state.shuffledVocab.length}`;
                    this.dom.answerInput.focus();
                } else {
                    this.endGame();
                }
            },

            checkAnswer() {
                const userAnswer = this.dom.answerInput.value.trim().toLowerCase();
                const correctAnswer = this.state.shuffledVocab[this.state.currentWordIndex].word.toLowerCase();

                if (userAnswer === correctAnswer) {
                    this.audio.playSound('correct');
                    this.ui.setMascot('happy');
                    this.state.score++;
                    this.dom.scoreDisplay.textContent = this.state.score;
                    this.dom.feedbackText.textContent = 'ถูกต้อง เก่งมากจ้า!';
                    this.dom.feedbackText.classList.add('text-green-500', 'correct-animation');
                } else {
                    this.audio.playSound('incorrect');
                    this.ui.setMascot('sad');
                    this.state.incorrectWords.push(this.state.shuffledVocab[this.state.currentWordIndex]);
                    this.dom.feedbackText.textContent = `ผิดน้า! คือ "${correctAnswer}"`;
                    this.dom.feedbackText.classList.add('text-red-500');
                    this.dom.gameContainer.classList.add('incorrect-animation');
                    setTimeout(() => this.dom.gameContainer.classList.remove('incorrect-animation'), 500);
                }
                this.proceedToNext();
            },
            
            proceedToNext() {
                this.state.currentWordIndex++;
                this.dom.answerInput.disabled = true;
                this.dom.submitButton.disabled = true;
                setTimeout(() => this.loadNextWord(), 1500); // ลดเวลารอเหลือ 1.5 วินาที
            },

            endGame() {
                this.showScreen('result');
                const gameEndTime = new Date();
                const durationSeconds = Math.round((gameEndTime - this.state.gameStartTime) / 1000);
                const minutes = Math.floor(durationSeconds / 60);
                const seconds = durationSeconds % 60;

                this.dom.finalScoreDisplay.textContent = `${this.state.score} / ${this.state.shuffledVocab.length}`;
                this.dom.totalTimeDisplay.textContent = `${minutes} นาที ${seconds} วินาที`;

                if (this.state.score === this.state.shuffledVocab.length && this.state.score > 0) {
                    this.dom.resultTitle.textContent = "สุดยอดไปเลย!";
                    this.vfx.startConfetti();
                } else {
                    this.dom.resultTitle.textContent = "จบเกมแล้วจ้า!";
                }

                if (this.state.incorrectWords.length > 0) {
                    this.dom.reviewSection.classList.remove('hidden');
                    this.dom.reviewList.innerHTML = '';
                    this.state.incorrectWords.forEach(item => {
                        const div = document.createElement('div');
                        div.className = 'flex items-center justify-between p-2 bg-white rounded-lg shadow-sm';
                        div.innerHTML = `<div class="flex items-center gap-3"><div class="w-10 h-10">${item.svg}</div><span class="font-semibold text-lg">${item.word}</span></div><button class="review-speak-btn btn btn-purple !p-2 !rounded-full" data-word="${item.word}"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/></svg></button>`;
                        this.dom.reviewList.appendChild(div);
                    });
                }
            },

            speak(word) {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(word);
                    utterance.lang = 'en-US';
                    utterance.rate = 0.9;
                    window.speechSynthesis.speak(utterance);
                }
            },
            
            audio: {
                init() { if (!vocabGame.state.audioContext) vocabGame.state.audioContext = new (window.AudioContext || window.webkitAudioContext)(); },
                playSound(type) { if (!vocabGame.state.audioContext) return; const audioCtx = vocabGame.state.audioContext; const o = audioCtx.createOscillator(), g = audioCtx.createGain(); o.connect(g); g.connect(audioCtx.destination); g.gain.setValueAtTime(0, audioCtx.currentTime); g.gain.linearRampToValueAtTime(0.3, audioCtx.currentTime + 0.01); if (type === 'correct') { o.type = 'sine'; o.frequency.setValueAtTime(600, audioCtx.currentTime); } else { o.type = 'sawtooth'; o.frequency.setValueAtTime(200, audioCtx.currentTime); } o.start(audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + 0.2); o.stop(audioCtx.currentTime + 0.2); }
            },
            
            ui: { setMascot(state) { vocabGame.dom.mascotContainer.innerHTML = vocabGame.data.mascotSVGs[state]; } },

            vfx: {
                startConfetti() { const canvas = vocabGame.dom.confettiCanvas; const ctx = canvas.getContext('2d'); canvas.width = window.innerWidth; canvas.height = window.innerHeight; const colors = ['#f472b6', '#c084fc', '#60a5fa', '#34d399', '#facc15']; vocabGame.state.confettiParticles = []; for (let i = 0; i < 200; i++) { vocabGame.state.confettiParticles.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height - canvas.height, color: colors[Math.floor(Math.random() * colors.length)], size: Math.random() * 5 + 5, speed: Math.random() * 5 + 2, angle: Math.random() * 360, }); } vocabGame.vfx.animateConfetti(); },
                animateConfetti() { const canvas = vocabGame.dom.confettiCanvas; const ctx = canvas.getContext('2d'); ctx.clearRect(0, 0, canvas.width, canvas.height); vocabGame.state.confettiParticles.forEach(p => { p.y += p.speed; p.x += Math.sin(p.angle); if (p.y > canvas.height) { p.y = -p.size; p.x = Math.random() * canvas.width; } ctx.fillStyle = p.color; ctx.fillRect(p.x, p.y, p.size, p.size); }); if (vocabGame.state.confettiParticles.length > 0) requestAnimationFrame(vocabGame.vfx.animateConfetti); },
                stopConfetti() { vocabGame.state.confettiParticles = []; const canvas = vocabGame.dom.confettiCanvas; if (canvas) { const ctx = canvas.getContext('2d'); ctx.clearRect(0, 0, canvas.width, canvas.height); } }
            }
        };
        window.onload = () => { vocabGame.init(); };
    </script>
</body>
</html>
