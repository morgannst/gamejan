<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Å‡∏°‡∏ó‡∏≤‡∏¢‡∏®‡∏±‡∏û‡∏ó‡πå‡∏´‡∏£‡∏£‡∏©‡∏≤</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Tone.js for sound effects and music -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    
    <!-- Google Fonts: Kanit -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Kanit', sans-serif;
            background-image: linear-gradient(to top right, #fde6f0, #e6e6fa);
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-8px); }
            20%, 40%, 60%, 80% { transform: translateX(8px); }
        }
        .shake { animation: shake 0.5s ease-in-out; }

        @keyframes bounce-in {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); }
        }
        .bounce-in { animation: bounce-in 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55); }

        .gradient-text {
            background-image: linear-gradient(to right, #ec4899, #8b5cf6);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <!-- Start Screen -->
    <div id="start-screen" class="w-full max-w-md mx-auto bg-white/80 backdrop-blur-sm rounded-3xl shadow-2xl shadow-pink-200/50 p-6 md:p-8 space-y-6 border-2 border-white">
        <h1 class="text-4xl font-bold text-center gradient-text">‡πÄ‡∏Å‡∏°‡∏ó‡∏≤‡∏¢‡∏®‡∏±‡∏û‡∏ó‡πå‡∏´‡∏£‡∏£‡∏©‡∏≤</h1>
        <div class="space-y-4">
            <input type="text" id="player-name-input" placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..." maxlength="15" class="w-full p-4 text-2xl text-center border-2 border-pink-200 rounded-lg focus:ring-4 focus:ring-pink-300 focus:border-transparent transition duration-300">
            <button id="start-game-btn" class="w-full bg-gradient-to-r from-green-400 to-teal-500 hover:from-green-500 hover:to-teal-600 text-white font-bold py-3 px-4 rounded-lg text-xl shadow-lg shadow-green-200/80 transition-all duration-300 transform hover:scale-105">
                ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°
            </button>
        </div>
        <div class="mt-6">
            <h2 class="text-2xl font-bold text-center text-pink-500 mb-3">üèÜ ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î üèÜ</h2>
            <div id="highscore-list" class="space-y-2">
                <!-- High scores will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Game Container (Initially Hidden) -->
    <div id="game-container" class="w-full max-w-md mx-auto bg-white/80 backdrop-blur-sm rounded-3xl shadow-2xl shadow-pink-200/50 p-6 md:p-8 space-y-6 border-2 border-white transition-all duration-500 hidden">
        
        <!-- Header -->
        <header>
            <h1 class="text-4xl font-bold text-center gradient-text">‡πÄ‡∏Å‡∏°‡∏ó‡∏≤‡∏¢‡∏®‡∏±‡∏û‡∏ó‡πå‡∏´‡∏£‡∏£‡∏©‡∏≤</h1>
            <div class="flex justify-between items-center mt-4">
                <div class="flex items-center gap-4">
                    <p id="score" class="text-lg font-bold text-gray-700">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: 0</p>
                    <button id="music-toggle-btn" title="‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏î‡∏ô‡∏ï‡∏£‡∏µ" class="text-pink-500 hover:text-purple-500 transition-colors focus:outline-none">
                        <svg id="music-on-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2z"/>
                        </svg>
                        <svg id="music-off-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2z"/>
                          <path stroke-linecap="round" stroke-linejoin="round" d="M3 3l18 18"/>
                        </svg>
                    </button>
                </div>
                <p id="progress-text" class="text-lg font-bold text-gray-700">‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà 1/10</p>
            </div>
            <div class="w-full bg-pink-100 rounded-full h-4 mt-2 overflow-hidden border border-white/50">
                <div id="progress-bar" class="bg-gradient-to-r from-pink-400 to-purple-400 h-full rounded-full transition-all duration-500"></div>
            </div>
        </header>

        <!-- Main Game Content -->
        <main class="space-y-4">
            <div class="relative group">
                <img id="word-image" src="" alt="‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ" class="w-full h-64 object-cover rounded-2xl shadow-lg border-4 border-white">
                <button id="listen-again-btn" class="absolute top-4 right-4 bg-gradient-to-br from-pink-500 to-purple-500 text-white rounded-full p-3 shadow-md transition-transform transform hover:scale-110 focus:outline-none focus:ring-4 focus:ring-pink-300">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                    </svg>
                </button>
            </div>
            
            <div class="space-y-4">
                 <input type="text" id="answer-input" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..." class="w-full p-4 text-2xl text-center border-2 border-pink-200 rounded-lg focus:ring-4 focus:ring-pink-300 focus:border-transparent transition duration-300">
                 <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                    <button id="hint-btn" class="md:col-span-1 w-full bg-gradient-to-r from-yellow-400 to-orange-400 hover:from-yellow-500 hover:to-orange-500 text-white font-bold py-3 px-4 rounded-lg text-xl shadow-lg shadow-yellow-200/80 transition-all duration-300 transform hover:scale-105 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                        </svg>
                        <span>‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ</span>
                    </button>
                    <button id="check-btn" class="md:col-span-2 w-full bg-gradient-to-r from-green-400 to-teal-500 hover:from-green-500 hover:to-teal-600 text-white font-bold py-3 px-4 rounded-lg text-xl shadow-lg shadow-green-200/80 transition-all duration-300 transform hover:scale-105">
                        ‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
                    </button>
                 </div>
            </div>
            
            <div id="feedback" class="h-24 flex flex-col items-center justify-center text-center font-bold transition-opacity duration-300"></div>
        </main>
    </div>

    <!-- End Game Modal -->
    <div id="end-game-modal" class="hidden fixed inset-0 bg-black/60 flex items-center justify-center p-4">
        <div id="modal-content" class="bg-white rounded-3xl p-8 text-center shadow-2xl space-y-4 transform">
            <div id="star-rating" class="flex justify-center mb-4"></div>
            <h2 id="end-game-title" class="text-4xl font-bold gradient-text">‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡πÑ‡∏õ‡πÄ‡∏•‡∏¢!</h2>
            <p id="final-score" class="text-2xl text-gray-800"></p>
            <p id="end-game-message" class="text-lg text-gray-600"></p>
            <div id="end-game-highscore-list" class="mt-4 text-left"></div>
            <button id="play-again-btn" class="w-full mt-4 bg-gradient-to-r from-pink-500 to-orange-400 hover:from-pink-600 hover:to-orange-500 text-white font-bold py-3 px-4 rounded-lg text-xl shadow-lg shadow-pink-200/80 transition-all duration-300 transform hover:scale-105">
                ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Elements ---
            const startScreen = document.getElementById('start-screen');
            const playerNameInput = document.getElementById('player-name-input');
            const startGameBtn = document.getElementById('start-game-btn');
            const highscoreListEl = document.getElementById('highscore-list');
            const gameContainer = document.getElementById('game-container');
            const scoreEl = document.getElementById('score');
            const progressTextEl = document.getElementById('progress-text');
            const progressBarEl = document.getElementById('progress-bar');
            const wordImageEl = document.getElementById('word-image');
            const listenAgainBtn = document.getElementById('listen-again-btn');
            const answerInput = document.getElementById('answer-input');
            const checkBtn = document.getElementById('check-btn');
            const hintBtn = document.getElementById('hint-btn');
            const feedbackEl = document.getElementById('feedback');
            const endGameModal = document.getElementById('end-game-modal');
            const modalContent = document.getElementById('modal-content');
            const starRatingEl = document.getElementById('star-rating');
            const endGameTitleEl = document.getElementById('end-game-title');
            const finalScoreEl = document.getElementById('final-score');
            const endGameMessageEl = document.getElementById('end-game-message');
            const endGameHighscoreListEl = document.getElementById('end-game-highscore-list');
            const playAgainBtn = document.getElementById('play-again-btn');
            const musicToggleBtn = document.getElementById('music-toggle-btn');
            const musicOnIcon = document.getElementById('music-on-icon');
            const musicOffIcon = document.getElementById('music-off-icon');

            // --- Game Data with Sentences ---
            const words = [
                { word: 'happy', hint: '‡πÄ‡∏î‡πá‡∏Å‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á‡∏¢‡∏¥‡πâ‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç', sentence: "She feels happy today.", translation: "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏ò‡∏≠‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç" }, { word: 'sad', hint: '‡πÄ‡∏î‡πá‡∏Å‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á‡∏£‡πâ‡∏≠‡∏á‡πÑ‡∏´‡πâ', sentence: "The boy is sad because he lost his toy.", translation: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡πÄ‡∏™‡∏µ‡∏¢‡πÉ‡∏à‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡∏´‡∏≤‡∏¢" }, { word: 'angry', hint: '‡πÄ‡∏î‡πá‡∏Å‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡∏∂‡πâ‡∏á‡πÇ‡∏Å‡∏£‡∏ò', sentence: "He gets angry when he is hungry.", translation: "‡πÄ‡∏Ç‡∏≤‡∏à‡∏∞‡πÇ‡∏Å‡∏£‡∏ò‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡∏≤‡∏´‡∏¥‡∏ß" }, { word: 'excited', hint: '‡πÄ‡∏î‡πá‡∏Å‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î‡∏î‡∏µ‡πÉ‡∏à', sentence: "The children are excited about the party.", translation: "‡πÄ‡∏î‡πá‡∏Å‡πÜ ‡∏ï‡∏∑‡πà‡∏ô‡πÄ‡∏ï‡πâ‡∏ô‡∏Å‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏õ‡∏≤‡∏£‡πå‡∏ï‡∏µ‡πâ" }, { word: 'scared', hint: '‡πÄ‡∏î‡πá‡∏Å‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏Å‡πÉ‡∏à‡∏Å‡∏•‡∏±‡∏ß', sentence: "She is scared of the dark.", translation: "‡πÄ‡∏ò‡∏≠‡∏Å‡∏•‡∏±‡∏ß‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏∑‡∏î" }, { word: 'tired', hint: '‡πÄ‡∏î‡πá‡∏Å‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏´‡∏≤‡∏ß‡∏ô‡∏≠‡∏ô', sentence: "I feel tired after a long day.", translation: "‡∏â‡∏±‡∏ô‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡πÄ‡∏´‡∏ô‡∏∑‡πà‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏≤‡∏ß‡∏ô‡∏≤‡∏ô" }, { word: 'confused', hint: '‡πÄ‡∏î‡πá‡∏Å‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏á', sentence: "The map made him feel confused.", translation: "‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡∏≤‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏™‡∏±‡∏ö‡∏™‡∏ô" }, { word: 'unhappy', hint: '‡πÄ‡∏î‡πá‡∏Å‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡∏∂‡πâ‡∏á‡πÑ‡∏°‡πà‡∏û‡∏≠‡πÉ‡∏à', sentence: "The cat looks unhappy in the rain.", translation: "‡πÅ‡∏°‡∏ß‡∏î‡∏π‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏ï‡∏≠‡∏ô‡∏ù‡∏ô‡∏ï‡∏Å" }, { word: 'upset', hint: '‡πÄ‡∏î‡πá‡∏Å‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏£‡πâ‡∏≠‡∏á‡πÑ‡∏´‡πâ', sentence: "Don't be upset, it was an accident.", translation: "‡∏≠‡∏¢‡πà‡∏≤‡πÄ‡∏™‡∏µ‡∏¢‡πÉ‡∏à‡πÄ‡∏•‡∏¢ ‡∏°‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏" }, { word: 'cheerful', hint: '‡πÄ‡∏î‡πá‡∏Å‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á‡∏¢‡∏¥‡πâ‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡πà‡∏≤‡πÄ‡∏£‡∏¥‡∏á', sentence: "He has a cheerful personality.", translation: "‡πÄ‡∏Ç‡∏≤‡∏°‡∏µ‡∏ö‡∏∏‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏£‡πà‡∏≤‡πÄ‡∏£‡∏¥‡∏á" }
            ];
            
            // --- Game State ---
            let playerName = '';
            let currentWordIndex = 0;
            let score = 0;
            let shuffledWords = [];
            let hintUsed = false;

            // --- Sound Effects & Music ---
            const fxSynth = new Tone.PolySynth(Tone.Synth).toDestination();
            function playCorrectSound() { const now = Tone.now(); fxSynth.triggerAttackRelease(["C5", "E5", "G5"], "8n", now); }
            function playIncorrectSound() { const now = Tone.now(); fxSynth.triggerAttackRelease("A2", "8n", now); }
            let isMusicPlaying = false;
            const musicSynth = new Tone.FMSynth({ harmonicity: 1.2, modulationIndex: 10, envelope: { attack: 0.01, decay: 0.5, sustain: 0.1, release: 1 }, modulationEnvelope: { attack: 0.1, decay: 0.2, sustain: 0.3, release: 1 } }).toDestination();
            musicSynth.volume.value = -22;
            const melody = new Tone.Sequence((time, note) => { musicSynth.triggerAttackRelease(note, "8n", time); }, ["C4", "E4", "G4", "C5", "G4", "E4"], "4n").start(0);
            melody.loop = true;
            function toggleMusic() {
                if (Tone.context.state !== 'running') { Tone.start(); }
                isMusicPlaying = !isMusicPlaying;
                if (isMusicPlaying) {
                    Tone.Transport.start();
                    musicOnIcon.classList.remove('hidden');
                    musicOffIcon.classList.add('hidden');
                } else {
                    Tone.Transport.stop();
                    musicOnIcon.classList.add('hidden');
                    musicOffIcon.classList.remove('hidden');
                }
            }

            // --- Speech Synthesis ---
            let speech = new SpeechSynthesisUtterance();
            speech.lang = "en-US";
            speech.volume = 1;
            speech.rate = 0.9;
            speech.pitch = 1.2;
            function speak(text) { window.speechSynthesis.cancel(); speech.text = text; window.speechSynthesis.speak(speech); }

            // --- High Score Logic ---
            const HIGHSCORES_KEY = 'vocabGameHighscores';
            function loadHighScores(element) {
                const highScores = JSON.parse(localStorage.getItem(HIGHSCORES_KEY)) || [];
                if (highScores.length === 0) {
                    element.innerHTML = '<p class="text-center text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</p>';
                    return;
                }
                const scoreHtml = highScores.map((score, index) => `
                    <div class="flex justify-between items-center bg-white/50 p-2 rounded-lg">
                        <span class="font-bold text-purple-600">${index + 1}. ${score.name}</span>
                        <span class="font-bold text-pink-500">${score.score} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</span>
                    </div>
                `).join('');
                element.innerHTML = scoreHtml;
            }

            function saveHighScore(name, score) {
                const newScore = { name, score };
                const highScores = JSON.parse(localStorage.getItem(HIGHSCORES_KEY)) || [];
                highScores.push(newScore);
                highScores.sort((a, b) => b.score - a.score);
                const topScores = highScores.slice(0, 5);
                localStorage.setItem(HIGHSCORES_KEY, JSON.stringify(topScores));
            }

            // --- Game Flow ---
            function handleStartGame() {
                const name = playerNameInput.value.trim();
                if (name === "") {
                    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡∏Ñ‡πà‡∏∞");
                    return;
                }
                playerName = name;
                startScreen.classList.add('hidden');
                gameContainer.classList.remove('hidden');
                startGame();
            }

            function startGame() {
                currentWordIndex = 0;
                score = 0;
                shuffledWords = [...words].sort(() => Math.random() - 0.5);
                endGameModal.classList.add('hidden');
                modalContent.classList.remove('bounce-in');
                displayQuestion();
            }

            function displayQuestion() {
                if (currentWordIndex >= shuffledWords.length) { endGame(); return; }
                const currentWord = shuffledWords[currentWordIndex];
                hintUsed = false;
                hintBtn.disabled = false;
                answerInput.disabled = false;
                checkBtn.disabled = false;
                updateProgress();
                answerInput.value = '';
                answerInput.focus();
                answerInput.classList.remove('border-red-400', 'shake');
                answerInput.classList.add('border-pink-200');
                feedbackEl.innerHTML = '';
                const imageUrl = `https://placehold.co/600x400/f8c3d0/4a2328?text=${encodeURIComponent(currentWord.hint)}`;
                wordImageEl.src = imageUrl;
                setTimeout(() => speak(currentWord.word), 300);
            }

            function showHint() {
                if (hintUsed) return;
                hintUsed = true;
                hintBtn.disabled = true;
                const correctAnswer = shuffledWords[currentWordIndex].word;
                answerInput.value = correctAnswer[0];
                answerInput.focus();
                feedbackEl.innerHTML = `<span class="text-xl text-orange-500">‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ‡πÅ‡∏•‡πâ‡∏ß (‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ô‡∏∞)</span>`;
            }

            function checkAnswer() {
                const userAnswer = answerInput.value.trim().toLowerCase();
                const correctAnswer = shuffledWords[currentWordIndex].word;
                answerInput.disabled = true;
                checkBtn.disabled = true;
                hintBtn.disabled = true;
                if (userAnswer === correctAnswer) {
                    handleCorrectAnswer();
                } else {
                    handleIncorrectAnswer();
                }
            }
            
            function showExampleAndProceed() {
                const currentWordData = shuffledWords[currentWordIndex];
                feedbackEl.innerHTML = `<div class="space-y-2 text-center animate-fade-in"><div class="flex items-center justify-center gap-2"><p class="text-xl text-blue-600">${currentWordData.sentence}</p><button onclick="speak('${currentWordData.sentence.replace(/'/g, "\\'")}')" class="text-blue-500 hover:text-blue-700"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" /></svg></button></div><p class="text-lg text-gray-500">"${currentWordData.translation}"</p></div>`;
                speak(currentWordData.sentence);
                setTimeout(() => {
                    currentWordIndex++;
                    displayQuestion();
                }, 4000);
            }

            function handleCorrectAnswer() {
                if (!hintUsed) { score++; }
                playCorrectSound();
                let correctMessage = hintUsed ? `‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! (‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)` : `‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!`;
                feedbackEl.innerHTML = `<div class="flex items-center gap-2 text-2xl text-green-500"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg><span>${correctMessage}</span></div>`;
                setTimeout(showExampleAndProceed, 1500);
            }

            function handleIncorrectAnswer() {
                const correctAnswer = shuffledWords[currentWordIndex].word;
                playIncorrectSound();
                feedbackEl.innerHTML = `<div class="flex flex-col items-center gap-1 text-2xl text-red-500"><div class="flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" /></svg><span>‡∏ú‡∏¥‡∏î‡∏à‡πâ‡∏≤!</span></div><span class="text-lg">‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏∑‡∏≠: "${correctAnswer}"</span></div>`;
                if (score > 0) score--;
                answerInput.classList.remove('border-pink-200');
                answerInput.classList.add('border-red-400', 'shake');
                setTimeout(showExampleAndProceed, 2000);
            }
            
            function updateProgress() {
                scoreEl.textContent = `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${score}`;
                progressTextEl.textContent = `‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà ${currentWordIndex >= words.length ? words.length : currentWordIndex + 1}/${words.length}`;
                const progressPercentage = ((currentWordIndex + 1) / words.length) * 100;
                progressBarEl.style.width = `${progressPercentage > 100 ? 100 : progressPercentage}%`;
            }

            function endGame() {
                saveHighScore(playerName, score);
                let starCount = 0;
                if (score >= 8) {
                    starCount = 3;
                    endGameTitleEl.textContent = '‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î‡πÑ‡∏õ‡πÄ‡∏•‡∏¢!';
                    endGameMessageEl.textContent = '‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å‡πÜ ‡πÄ‡∏•‡∏¢‡∏ô‡∏∞ ‡∏•‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÑ‡∏´‡∏°?';
                } else if (score >= 5) {
                    starCount = 2;
                    endGameTitleEl.textContent = '‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å‡∏à‡πâ‡∏≤!';
                    endGameMessageEl.textContent = '‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏°‡∏≤‡∏Å! ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠ 3 ‡∏î‡∏≤‡∏ß‡∏ô‡∏∞';
                } else {
                    starCount = 1;
                    endGameTitleEl.textContent = '‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏°‡∏≤‡∏Å!';
                    endGameMessageEl.textContent = '‡∏™‡∏π‡πâ‡πÜ ‡∏ô‡∏∞ ‡∏•‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏î‡∏π‡∏™‡∏¥!';
                }
                
                let starsHtml = '';
                const starSvg = `<svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>`;
                for (let i = 0; i < 3; i++) {
                    starsHtml += `<span class="${i < starCount ? 'text-yellow-400' : 'text-gray-300'}">${starSvg}</span>`;
                }
                starRatingEl.innerHTML = starsHtml;

                finalScoreEl.textContent = `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: ${score}/${words.length}`;
                
                gameContainer.classList.add('hidden');
                endGameModal.classList.remove('hidden');
                loadHighScores(endGameHighscoreListEl);
                setTimeout(() => { modalContent.classList.add('bounce-in'); }, 50);
            }

            function resetToStartScreen() {
                endGameModal.classList.add('hidden');
                startScreen.classList.remove('hidden');
                loadHighScores(highscoreListEl);
            }

            // --- Event Listeners ---
            startGameBtn.addEventListener('click', handleStartGame);
            playerNameInput.addEventListener('keydown', (e) => { if(e.key === 'Enter') handleStartGame(); });
            listenAgainBtn.addEventListener('click', () => { if (currentWordIndex < shuffledWords.length) speak(shuffledWords[currentWordIndex].word); });
            checkBtn.addEventListener('click', checkAnswer);
            hintBtn.addEventListener('click', showHint);
            answerInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') checkAnswer(); });
            playAgainBtn.addEventListener('click', resetToStartScreen);
            musicToggleBtn.addEventListener('click', toggleMusic);

            // --- Initialisation ---
            window.speechSynthesis.onvoiceschanged = () => { const voices = window.speechSynthesis.getVoices(); const englishVoice = voices.find(voice => voice.lang === 'en-US' || voice.lang.startsWith('en-')); if (englishVoice) speech.voice = englishVoice; };
            window.speak = speak;
            loadHighScores(highscoreListEl);
        });
    </script>
</body>
</html>
