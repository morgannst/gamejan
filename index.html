<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Vocab Fun for Kids!</title>
    <!-- Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tone.js (CDN) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏î‡∏ô‡∏ï‡∏£‡∏µ‡πÅ‡∏•‡∏∞‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <!-- Google Fonts: ‡πÉ‡∏ä‡πâ‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å‡πÜ -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600&family=Mali:wght@400;600&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Fredoka', 'sans-serif'],
                        thai: ['Mali', 'cursive'],
                    },
                    colors: {
                        'candy-pink': '#FFCce6',
                        'candy-purple': '#D4C1EC',
                        'candy-blue': '#BEE3DB',
                        'candy-text': '#5D576B',
                        'bright-pink': '#FF6B6B'
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #FFF0F5;
            background-image: radial-gradient(#FFCce6 2px, transparent 2px);
            background-size: 30px 30px;
        }
        .btn-bounce:active {
            transform: scale(0.95);
        }
        /* ‡πÅ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å‡πÜ */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        .floating-element {
            animation: float 3s ease-in-out infinite;
        }
        .hidden-screen {
            display: none;
        }
    </style>
</head>
<body class="font-sans text-candy-text min-h-screen flex items-center justify-center p-4">

    <!-- Container ‡∏´‡∏•‡∏±‡∏Å -->
    <div class="bg-white/90 backdrop-blur-sm shadow-2xl rounded-3xl w-full max-w-2xl overflow-hidden border-4 border-white ring-4 ring-pink-100 relative">
        
        <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏á -->
        <div class="absolute top-4 right-4 z-10">
            <button id="toggle-music" class="bg-candy-purple text-white p-2 rounded-full hover:bg-purple-400 transition shadow-md" title="‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î ‡πÄ‡∏û‡∏•‡∏á">
                üéµ
            </button>
        </div>

        <!-- 1. ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (Start Screen) -->
        <div id="start-screen" class="p-8 text-center flex flex-col items-center space-y-6">
            <h1 class="text-5xl font-bold text-pink-500 font-thai floating-element">‡∏®‡∏±‡∏û‡∏ó‡πå‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©<br>‡πÅ‡∏™‡∏ô‡∏™‡∏ô‡∏∏‡∏Å üéÄ</h1>
            <p class="text-xl text-purple-400 font-thai">‡πÄ‡∏Å‡∏°‡∏ó‡∏≤‡∏¢‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ô‡πÄ‡∏Å‡πà‡∏á</p>
            
            <div class="w-full max-w-md bg-pink-50 p-6 rounded-2xl border-2 border-pink-100">
                <label class="block text-left text-lg mb-2 font-thai text-pink-400">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡∏π:</label>
                <input type="text" id="player-name" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏•‡∏¢‡∏à‡πâ‡∏≤..." class="w-full p-4 rounded-xl border-2 border-pink-200 focus:border-pink-400 focus:outline-none text-xl text-center shadow-inner">
            </div>

            <button id="start-btn" class="bg-gradient-to-r from-pink-400 to-purple-400 text-white text-2xl font-bold py-4 px-12 rounded-full shadow-lg transform transition hover:scale-105 btn-bounce font-thai">
                ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÄ‡∏•‡∏¢! üöÄ
            </button>

            <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î -->
            <div class="w-full mt-6">
                <h3 class="text-xl font-bold text-gray-500 mb-3 font-thai">üèÜ ‡∏Ñ‡∏ô‡πÄ‡∏Å‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</h3>
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                    <table class="w-full text-left">
                        <tbody id="high-score-list" class="divide-y divide-gray-50">
                            <!-- JS ‡∏à‡∏∞‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ -->
                            <tr><td class="p-3 text-center text-gray-400 font-thai">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡πâ‡∏≤</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 2. ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏° (Game Screen) -->
        <div id="game-screen" class="hidden-screen p-6 relative">
            <!-- Header: Score & Progress -->
            <div class="flex justify-between items-center mb-6">
                <div class="bg-yellow-100 px-4 py-2 rounded-full border-2 border-yellow-200">
                    <span class="font-bold text-yellow-600">‚≠ê ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="current-score">0</span></span>
                </div>
                <div class="flex-1 mx-4">
                    <div class="flex justify-between text-sm text-purple-400 mb-1 font-thai">
                        <span>‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà <span id="question-number">1</span>/10</span>
                        <span id="progress-percent">10%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-4">
                        <div id="progress-bar" class="bg-gradient-to-r from-pink-300 to-purple-300 h-4 rounded-full transition-all duration-500" style="width: 10%"></div>
                    </div>
                </div>
            </div>

            <!-- Question Area -->
            <div class="text-center space-y-6">
                <!-- Hint Image (Emoji/Icon style) -->
                <div class="relative inline-block group">
                    <div id="hint-image" class="text-8xl transform transition hover:scale-110 cursor-default floating-element">
                        üìè
                    </div>
                    <p id="hint-text" class="text-gray-400 text-sm mt-2 font-thai">‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ: ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ß‡∏±‡∏î‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô</p>
                </div>

                <!-- Audio Replay -->
                <div>
                    <button id="play-sound-btn" class="bg-blue-100 text-blue-500 p-3 rounded-full hover:bg-blue-200 transition shadow-md btn-bounce">
                        üîä ‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                    </button>
                </div>

                <!-- Input Area -->
                <div class="relative max-w-sm mx-auto">
                    <input type="text" id="answer-input" autocomplete="off" class="w-full p-4 text-center text-2xl tracking-widest border-b-4 border-pink-200 bg-transparent focus:outline-none focus:border-pink-500 rounded-lg placeholder-gray-300 font-bold text-purple-600 lowercase" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö...">
                    
                    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢ -->
                    <button id="hint-btn" class="absolute right-2 top-2 text-yellow-400 hover:text-yellow-500 transition p-2 bg-yellow-50 rounded-full border border-yellow-100" title="‡∏Ç‡∏≠‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢ (‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡∏ô‡∏∞)">
                        üí°
                    </button>
                </div>
                <p id="hint-feedback" class="text-xs text-red-400 hidden font-thai">‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏•‡πâ‡∏ß (‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ô‡∏∞‡∏à‡πä‡∏∞)</p>

                <button id="submit-btn" class="w-full bg-pink-400 text-white font-bold py-3 rounded-xl hover:bg-pink-500 transition shadow-lg btn-bounce font-thai text-xl">
                    ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö ‚ú®
                </button>
            </div>

            <!-- Feedback Modal (Overlay) -->
            <div id="feedback-overlay" class="absolute inset-0 bg-white/95 z-20 hidden flex-col items-center justify-center text-center p-6 rounded-3xl">
                <div id="feedback-icon" class="text-6xl mb-4">üéâ</div>
                <h2 id="feedback-title" class="text-3xl font-bold mb-2 font-thai">‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πâ‡∏≤!</h2>
                <p id="feedback-correct-answer" class="text-xl text-purple-500 font-bold mb-4 hidden"></p>
                
                <div class="bg-purple-50 p-4 rounded-xl border border-purple-100 w-full mb-6">
                    <p id="example-sentence" class="text-lg text-gray-700 italic mb-1">"The table is one meter long."</p>
                    <p id="example-translation" class="text-md text-gray-500 font-thai">‡πÇ‡∏ï‡πä‡∏∞‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÄ‡∏°‡∏ï‡∏£</p>
                    <button id="play-example-btn" class="mt-2 text-sm bg-purple-200 text-purple-700 px-3 py-1 rounded-full hover:bg-purple-300">
                        üîä ‡∏ü‡∏±‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ
                    </button>
                </div>

                <div class="w-full bg-gray-100 h-2 rounded-full overflow-hidden">
                    <div id="timer-bar" class="bg-green-400 h-full w-full"></div>
                </div>
                <p class="text-xs text-gray-400 mt-2 font-thai">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏õ‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡πÑ‡∏õ...</p>
            </div>
        </div>

        <!-- 3. ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏• (End Screen) -->
        <div id="end-screen" class="hidden-screen p-8 text-center flex flex-col items-center space-y-6">
            <h2 class="text-4xl font-bold text-purple-500 font-thai">‡∏à‡∏ö‡πÄ‡∏Å‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏à‡πâ‡∏≤!</h2>
            
            <div id="star-display" class="text-6xl space-x-2 my-4 floating-element">
                ‚≠ê ‚≠ê ‚≠ê
            </div>
            
            <div class="bg-pink-50 p-6 rounded-2xl border-2 border-pink-200 w-full">
                <p class="text-gray-500 font-thai text-lg">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á <span id="end-player-name" class="font-bold text-pink-500">‡∏ô‡πâ‡∏≠‡∏á...</span></p>
                <p id="end-score" class="text-5xl font-bold text-purple-600 my-2">8/10</p>
                <p id="end-message" class="text-pink-400 font-thai">‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î‡πÑ‡∏õ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏ô‡πÄ‡∏Å‡πà‡∏á!</p>
            </div>

            <div class="w-full">
                <h3 class="text-lg font-bold text-gray-400 mb-2 font-thai">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
                <div class="bg-white rounded-lg border p-4 h-32 overflow-y-auto" id="end-high-score-list">
                    <!-- High Score List -->
                </div>
            </div>

            <button id="restart-btn" class="bg-green-400 text-white text-xl font-bold py-3 px-8 rounded-full shadow-lg transform transition hover:scale-105 btn-bounce font-thai">
                ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á üîÑ
            </button>
        </div>

    </div>

    <script>
        // --- 1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏° (Data Configuration) ---
        const vocabList = [
            { word: "meter", thaiHint: "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ß‡∏±‡∏î‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô (‡πÄ‡∏°‡∏ï‡∏£)", emoji: "üìè", sentence: "The table is one meter long.", translation: "‡πÇ‡∏ï‡πä‡∏∞‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÄ‡∏°‡∏ï‡∏£" },
            { word: "centimeter", thaiHint: "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ß‡∏±‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å (‡πÄ‡∏ã‡∏ô‡∏ï‡∏¥‡πÄ‡∏°‡∏ï‡∏£)", emoji: "ü§è", sentence: "My pencil is ten centimeters long.", translation: "‡∏î‡∏¥‡∏ô‡∏™‡∏≠‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô‡∏¢‡∏≤‡∏ß 10 ‡πÄ‡∏ã‡∏ô‡∏ï‡∏¥‡πÄ‡∏°‡∏ï‡∏£" },
            { word: "length", thaiHint: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß", emoji: "‚ÜîÔ∏è", sentence: "Measure the length of the box.", translation: "‡∏à‡∏á‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏Ç‡∏≠‡∏á‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÉ‡∏ö‡∏ô‡∏µ‡πâ" },
            { word: "height", thaiHint: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á", emoji: "‚ÜïÔ∏è", sentence: "What is your height?", translation: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?" },
            { word: "width", thaiHint: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á", emoji: "‚èπÔ∏è", sentence: "The width of the door is small.", translation: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏ô‡∏µ‡πâ‡πÅ‡∏Ñ‡∏ö" },
            { word: "distance", thaiHint: "‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á", emoji: "üõ£Ô∏è", sentence: "The distance to school is far.", translation: "‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ô‡∏±‡πâ‡∏ô‡πÑ‡∏Å‡∏•" },
            { word: "estimating", thaiHint: "‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≤‡∏î‡∏Ñ‡∏∞‡πÄ‡∏ô/‡∏Å‡∏∞‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì", emoji: "ü§î", sentence: "I am estimating the cost.", translation: "‡∏â‡∏±‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏≤‡∏î‡∏Ñ‡∏∞‡πÄ‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤‡∏≠‡∏¢‡∏π‡πà" },
            { word: "actual", thaiHint: "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏£‡∏¥‡∏á/‡∏Ç‡∏≠‡∏á‡∏à‡∏£‡∏¥‡∏á", emoji: "‚úÖ", sentence: "This is the actual size.", translation: "‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Ç‡∏ô‡∏≤‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡πâ‡∏à‡∏£‡∏¥‡∏á" },
            { word: "longest", thaiHint: "‡∏¢‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î", emoji: "ü¶í", sentence: "The Nile is the longest river.", translation: "‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥‡πÑ‡∏ô‡∏•‡πå‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥‡∏ó‡∏µ‡πà‡∏¢‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î" },
            { word: "shortest", thaiHint: "‡∏™‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î", emoji: "üêõ", sentence: "February is the shortest month.", translation: "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î" }
        ];

        // --- 2. ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏Å‡∏° (Game State) ---
        let gameState = {
            playerName: "",
            score: 0,
            currentQuestionIndex: 0,
            shuffledQuestions: [],
            isHintUsed: false,
            isMusicPlaying: false
        };

        // --- 3. ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏µ‡∏¢‡∏á (Audio & Music with Tone.js & Web Speech API) ---
        let bgMusic;
        let synth; // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Sound Effects

        async function initAudio() {
            await Tone.start();
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á Synth ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Sound Effect
            synth = new Tone.PolySynth(Tone.Synth).toDestination();
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á Background Music Loop ‡∏á‡πà‡∏≤‡∏¢‡πÜ ‡∏ô‡∏∏‡πà‡∏°‡πÜ
            bgMusic = new Tone.Loop(time => {
                const notes = ["C4", "E4", "G4", "B4"];
                const note = notes[Math.floor(Math.random() * notes.length)];
                // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏ö‡∏≤‡πÜ
                synth.triggerAttackRelease(note, "8n", time, 0.05);
            }, "2n");
            
            Tone.Transport.bpm.value = 100;
        }

        function toggleMusic() {
            gameState.isMusicPlaying = !gameState.isMusicPlaying;
            const btn = document.getElementById('toggle-music');
            if (gameState.isMusicPlaying) {
                Tone.Transport.start();
                bgMusic.start(0);
                btn.textContent = "üîá";
                btn.classList.add('bg-pink-400');
                btn.classList.remove('bg-candy-purple');
            } else {
                Tone.Transport.stop();
                bgMusic.stop();
                btn.textContent = "üéµ";
                btn.classList.remove('bg-pink-400');
                btn.classList.add('bg-candy-purple');
            }
        }

        function playSoundEffect(type) {
            if(!synth) return;
            const now = Tone.now();
            switch(type) {
                case 'correct':
                    synth.triggerAttackRelease(["C5", "E5", "G5", "C6"], "8n", now);
                    break;
                case 'wrong':
                    synth.triggerAttackRelease(["G3", "C3"], "4n", now);
                    break;
                case 'click':
                    synth.triggerAttackRelease("C5", "32n", now, 0.1);
                    break;
                case 'win':
                    synth.triggerAttackRelease(["C4", "E4", "G4", "C5", "E5", "G5"], "4n", now);
                    break;
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏û‡∏π‡∏î‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© (‡πÉ‡∏ä‡πâ Web Speech API ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ä‡∏±‡∏î‡∏Å‡∏ß‡πà‡∏≤ Tone.js)
        function speakText(text) {
            // ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡πà‡∏≠‡∏ô
            window.speechSynthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US'; // ‡πÄ‡∏ô‡πâ‡∏ô‡∏™‡∏≥‡πÄ‡∏ô‡∏µ‡∏¢‡∏á‡∏≠‡πÄ‡∏°‡∏£‡∏¥‡∏Å‡∏±‡∏ô
            utterance.rate = 0.8; // ‡∏û‡∏π‡∏î‡∏ä‡πâ‡∏≤‡∏•‡∏á‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏î‡πá‡∏Å‡∏ü‡∏±‡∏á‡∏ó‡∏±‡∏ô
            
            // ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏´‡∏≤‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á (Google US English ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á)
            const voices = window.speechSynthesis.getVoices();
            const preferredVoice = voices.find(v => v.name.includes("Google US English") || v.name.includes("Female"));
            if (preferredVoice) utterance.voice = preferredVoice;

            window.speechSynthesis.speak(utterance);
        }

        // --- 4. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡∏° (Core Logic) ---

        function initGame() {
            const nameInput = document.getElementById('player-name').value.trim();
            if (!nameInput) {
                alert("‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏à‡πä‡∏∞!");
                return;
            }
            
            gameState.playerName = nameInput;
            gameState.score = 0;
            gameState.currentQuestionIndex = 0;
            // ‡∏™‡∏∏‡πà‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå
            gameState.shuffledQuestions = [...vocabList].sort(() => Math.random() - 0.5);
            
            // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á
            initAudio().then(() => {
                if(!gameState.isMusicPlaying) toggleMusic(); // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏•‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
            });

            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
            document.getElementById('start-screen').classList.add('hidden-screen');
            document.getElementById('end-screen').classList.add('hidden-screen');
            document.getElementById('game-screen').classList.remove('hidden-screen');

            loadQuestion();
        }

        function loadQuestion() {
            const currentQ = gameState.shuffledQuestions[gameState.currentQuestionIndex];
            gameState.isHintUsed = false;

            // Reset UI
            document.getElementById('answer-input').value = "";
            document.getElementById('answer-input').focus();
            document.getElementById('hint-feedback').classList.add('hidden');
            document.getElementById('feedback-overlay').classList.add('hidden'); // ‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏â‡∏•‡∏¢‡πÄ‡∏Å‡πà‡∏≤
            document.getElementById('feedback-overlay').classList.remove('flex');

            // Update Info
            document.getElementById('current-score').innerText = gameState.score;
            document.getElementById('question-number').innerText = gameState.currentQuestionIndex + 1;
            
            const progress = ((gameState.currentQuestionIndex) / 10) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
            document.getElementById('progress-percent').innerText = `${Math.round(progress)}%`;

            // Update Content
            document.getElementById('hint-image').innerText = currentQ.emoji;
            document.getElementById('hint-text').innerText = "‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ: " + currentQ.thaiHint;

            // Play Audio Automatically
            setTimeout(() => speakText(currentQ.word), 500);
        }

        function useHint() {
            if (gameState.isHintUsed) return;
            gameState.isHintUsed = true;
            
            playSoundEffect('click');
            const currentWord = gameState.shuffledQuestions[gameState.currentQuestionIndex].word;
            const input = document.getElementById('answer-input');
            
            // ‡πÉ‡∏™‡πà‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÅ‡∏£‡∏Å‡πÉ‡∏´‡πâ
            input.value = currentWord.charAt(0);
            input.focus();
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            document.getElementById('hint-feedback').classList.remove('hidden');
        }

        function checkAnswer() {
            const input = document.getElementById('answer-input').value.trim().toLowerCase();
            const currentQ = gameState.shuffledQuestions[gameState.currentQuestionIndex];
            
            if (!input) return;

            if (input === currentQ.word.toLowerCase()) {
                // ‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å
                handleCorrectAnswer();
            } else {
                // ‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î
                handleWrongAnswer();
            }
        }

        function handleCorrectAnswer() {
            playSoundEffect('correct');
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ Hint ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)
            if (!gameState.isHintUsed) {
                gameState.score += 1;
            }
            
            showFeedback(true);
        }

        function handleWrongAnswer() {
            playSoundEffect('wrong');
            
            // ‡∏´‡∏±‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô 1 ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
            if (gameState.score > 0) {
                gameState.score -= 1;
            }
            
            showFeedback(false);
        }

        function showFeedback(isCorrect) {
            const currentQ = gameState.shuffledQuestions[gameState.currentQuestionIndex];
            const overlay = document.getElementById('feedback-overlay');
            const title = document.getElementById('feedback-title');
            const icon = document.getElementById('feedback-icon');
            const corrAns = document.getElementById('feedback-correct-answer');

            overlay.classList.remove('hidden');
            overlay.classList.add('flex');

            // Setup Example content
            document.getElementById('example-sentence').innerText = `"${currentQ.sentence}"`;
            document.getElementById('example-translation').innerText = currentQ.translation;
            
            // ‡∏õ‡∏∏‡πà‡∏°‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ
            document.getElementById('play-example-btn').onclick = () => speakText(currentQ.sentence);

            if (isCorrect) {
                title.innerText = "‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å‡∏à‡πâ‡∏≤! ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!";
                title.className = "text-3xl font-bold mb-2 font-thai text-green-500";
                icon.innerText = "üéâ";
                corrAns.classList.add('hidden');
                // ‡∏û‡∏π‡∏î‡∏ä‡∏°‡πÄ‡∏ä‡∏¢‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ (Optional)
            } else {
                title.innerText = "‡∏ú‡∏¥‡∏î‡∏ô‡∏¥‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ô‡∏∞!";
                title.className = "text-3xl font-bold mb-2 font-thai text-red-400";
                icon.innerText = "üí™"; // ‡πÉ‡∏´‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à
                corrAns.innerText = `‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏∑‡∏≠: ${currentQ.word}`;
                corrAns.classList.remove('hidden');
            }

            document.getElementById('current-score').innerText = gameState.score;

            // Timer bar animation & Auto next
            const bar = document.getElementById('timer-bar');
            bar.style.transition = 'none';
            bar.style.width = '100%';
            
            setTimeout(() => {
                bar.style.transition = 'width 4s linear';
                bar.style.width = '0%';
            }, 100);

            // ‡∏£‡∏≠ 4 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡πÑ‡∏õ
            setTimeout(nextQuestion, 4000);
        }

        function nextQuestion() {
            gameState.currentQuestionIndex++;
            if (gameState.currentQuestionIndex < 10) {
                loadQuestion();
            } else {
                endGame();
            }
        }

        function endGame() {
            document.getElementById('game-screen').classList.add('hidden-screen');
            document.getElementById('end-screen').classList.remove('hidden-screen');
            playSoundEffect('win');

            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏î‡∏≤‡∏ß
            let stars = "";
            let message = "";
            if (gameState.score >= 8) {
                stars = "‚≠ê‚≠ê‚≠ê";
                message = "‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î! ‡∏´‡∏ô‡∏π‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å‡πÜ ‡πÄ‡∏•‡∏¢!";
            } else if (gameState.score >= 5) {
                stars = "‚≠ê‚≠ê";
                message = "‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å! ‡∏ù‡∏∂‡∏Å‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î‡∏à‡∏∞‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡πÄ‡∏•‡∏¢!";
            } else {
                stars = "‚≠ê";
                message = "‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏°‡∏≤‡∏Å‡∏à‡πâ‡∏∞ ‡∏™‡∏π‡πâ‡πÜ ‡∏ô‡∏∞!";
            }

            document.getElementById('star-display').innerText = stars;
            document.getElementById('end-player-name').innerText = gameState.playerName;
            document.getElementById('end-score').innerText = `${gameState.score}/10`;
            document.getElementById('end-message').innerText = message;

            saveHighScore();
            renderHighScores();
        }

        // --- 5. ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (Local Storage) ---

        function saveHighScore() {
            const newScore = { name: gameState.playerName, score: gameState.score };
            let highScores = JSON.parse(localStorage.getItem('vocabGameHighScores')) || [];
            
            highScores.push(newScore);
            highScores.sort((a, b) => b.score - a.score);
            highScores = highScores.slice(0, 5); // ‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏Ñ‡πà Top 5
            
            localStorage.setItem('vocabGameHighScores', JSON.stringify(highScores));
        }

        function renderHighScores() {
            const highScores = JSON.parse(localStorage.getItem('vocabGameHighScores')) || [];
            
            const createListHTML = (scores) => {
                if (scores.length === 0) return '<tr><td class="p-3 text-center text-gray-400 font-thai">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡πâ‡∏≤</td></tr>';
                return scores.map((s, index) => `
                    <tr class="border-b last:border-0">
                        <td class="p-3 font-bold text-pink-400 w-8">#${index + 1}</td>
                        <td class="p-3 text-gray-600 font-thai">${s.name}</td>
                        <td class="p-3 text-right font-bold text-purple-500">${s.score} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</td>
                    </tr>
                `).join('');
            };

            document.getElementById('high-score-list').innerHTML = createListHTML(highScores);
            
            // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ End Screen (‡πÉ‡∏ä‡πâ table structure ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠ simplified)
            const endList = highScores.map((s, index) => 
                `<div class="flex justify-between items-center border-b border-gray-100 py-2 px-4">
                    <span class="text-pink-400 font-bold">#${index+1}</span>
                    <span class="text-gray-600 font-thai">${s.name}</span>
                    <span class="text-purple-500 font-bold">${s.score}</span>
                 </div>`
            ).join('');
            document.getElementById('end-high-score-list').innerHTML = endList || "<p class='text-gray-300 pt-4'>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>";
        }

        function restartGame() {
            document.getElementById('end-screen').classList.add('hidden-screen');
            document.getElementById('start-screen').classList.remove('hidden-screen');
            renderHighScores();
            // Clear input
            document.getElementById('player-name').value = "";
        }

        // --- 6. Event Listeners ---

        document.addEventListener('DOMContentLoaded', () => {
            renderHighScores();

            document.getElementById('start-btn').addEventListener('click', initGame);
            document.getElementById('toggle-music').addEventListener('click', toggleMusic);
            document.getElementById('play-sound-btn').addEventListener('click', () => {
                const word = gameState.shuffledQuestions[gameState.currentQuestionIndex].word;
                speakText(word);
                playSoundEffect('click');
            });
            document.getElementById('hint-btn').addEventListener('click', useHint);
            document.getElementById('submit-btn').addEventListener('click', checkAnswer);
            document.getElementById('restart-btn').addEventListener('click', restartGame);

            // ‡∏Å‡∏î Enter ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏≠‡∏ö‡πÑ‡∏î‡πâ
            document.getElementById('answer-input').addEventListener('keypress', function (e) {
                if (e.key === 'Enter') checkAnswer();
            });
        });

    </script>
</body>
</html>
