<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ó‡∏î‡∏™‡∏≠‡∏ö Spelling Test 16</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Itim&family=Mali:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-pink: #fce4ec;
            --accent-pink: #f48fb1;
            --text-purple: #7e57c2;
        }
        body {
            font-family: 'Itim', 'Mali', cursive;
            background-color: #fff0f5;
            background-image: 
                radial-gradient(#f8bbd0 3px, transparent 3px),
                linear-gradient(180deg, #fff0f5 0%, #f3e5f5 100%);
            background-size: 30px 30px, 100% 100%;
            min-height: 100vh;
            overflow-x: hidden;
        }
        .chibi-bounce { animation: bounce 3s infinite ease-in-out; }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 8px solid var(--primary-pink);
            box-shadow: 0 10px 30px rgba(244, 143, 177, 0.25);
            border-radius: 2rem;
        }
        .star-rating {
            color: #ffca28;
            font-size: 3.5rem;
            filter: drop-shadow(0 2px 2px rgba(255, 143, 0, 0.5));
        }
        .progress-bar { transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); }
        
        /* Button Interactions */
        .btn-hover-pop { transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        .btn-hover-pop:hover {
            transform: scale(1.05) translateY(-2px);
            box-shadow: 0 5px 15px rgba(233, 30, 99, 0.3);
        }
        .btn-hover-pop:active { transform: scale(0.95); }

        /* Inputs */
        .cute-input {
            border: 4px dashed #f8bbd0;
            background-color: #fff;
            transition: all 0.3s;
        }
        .cute-input:focus {
            border-color: #f06292;
            border-style: solid;
            background-color: #fff9fc;
        }

        /* Scrollbar */
        .vocab-scroll::-webkit-scrollbar { width: 8px; }
        .vocab-scroll::-webkit-scrollbar-track { background: #fff0f5; border-radius: 10px; }
        .vocab-scroll::-webkit-scrollbar-thumb { background: #f8bbd0; border-radius: 10px; }

        /* SVG Styling */
        .hint-svg { width: 100%; height: 100%; max-height: 300px; }
    </style>
</head>
<body class="p-4 md:p-6 flex items-center justify-center min-h-screen">

    <div id="app" class="w-full max-w-2xl relative">
        
        <!-- Background Elements -->
        <div class="fixed top-10 left-10 text-6xl opacity-20 pointer-events-none animate-pulse">‚òÅÔ∏è</div>
        <div class="fixed bottom-10 right-10 text-6xl opacity-20 pointer-events-none animate-pulse" style="animation-delay: 1s;">‚òÅÔ∏è</div>

        <!-- SCREEN: START -->
        <div id="screen-start" class="glass-card p-6 md:p-8 text-center relative z-10">
            <div class="flex justify-center mb-4">
                <svg width="120" height="120" viewBox="0 0 100 100" class="chibi-bounce drop-shadow-md">
                    <circle cx="50" cy="50" r="45" fill="#FFF" stroke="#F48FB1" stroke-width="3"/>
                    <circle cx="50" cy="45" r="30" fill="#FFE0BD" />
                    <path d="M20 45 Q20 15 50 15 Q80 15 80 45" fill="#5D4037" />
                    <path d="M15 45 Q10 60 25 70" fill="none" stroke="#5D4037" stroke-width="8" stroke-linecap="round" />
                    <path d="M85 45 Q90 60 75 70" fill="none" stroke="#5D4037" stroke-width="8" stroke-linecap="round" />
                    <circle cx="40" cy="45" r="3.5" fill="#3E2723" />
                    <circle cx="60" cy="45" r="3.5" fill="#3E2723" />
                    <circle cx="32" cy="52" r="4" fill="#F8BBD0" opacity="0.6" />
                    <circle cx="68" cy="52" r="4" fill="#F8BBD0" opacity="0.6" />
                    <path d="M45 55 Q50 60 55 55" fill="none" stroke="#F06292" stroke-width="2.5" stroke-linecap="round" />
                    <path d="M30 20 L40 25 L30 30 Z" fill="#F06292" />
                    <path d="M70 20 L60 25 L70 30 Z" fill="#F06292" />
                </svg>
            </div>
            
            <h1 class="text-3xl md:text-5xl font-bold text-pink-500 mb-2 drop-shadow-sm" style="font-family: 'Mali', cursive;">‡∏ó‡∏î‡∏™‡∏≠‡∏ö Spelling Test 16</h1>
            
            <!-- Vocabulary Preview -->
            <div class="my-4 bg-white/60 p-4 rounded-2xl border-2 border-pink-100 shadow-inner">
                <h2 class="text-lg font-bold text-purple-600 mb-2 flex items-center justify-center gap-2">
                    <span>‚ú®</span> ‡∏°‡∏µ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå <span>‚ú®</span>
                </h2>
                <div id="vocab-list-preview" class="flex flex-wrap justify-center gap-2 max-h-40 overflow-y-auto vocab-scroll p-1">
                    <!-- Vocab items injected by JS -->
                </div>
            </div>

            <div class="mb-6 max-w-sm mx-auto">
                <label class="block text-purple-600 text-lg mb-2 font-bold">‡∏´‡∏ô‡∏π‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∞‡πÑ‡∏£‡∏à‡πä‡∏∞?</label>
                <input type="text" id="player-name" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô..." 
                    class="w-full p-3 rounded-3xl cute-input text-center text-xl text-purple-700 outline-none placeholder-pink-200">
            </div>

            <button onclick="Game.start()" class="bg-gradient-to-b from-pink-400 to-pink-500 text-white font-bold py-3 px-10 rounded-full text-xl shadow-lg border-b-4 border-pink-700 btn-hover-pop mb-6 w-full max-w-xs">
                ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏•‡∏¢! üöÄ
            </button>

            <div class="mt-2 text-left bg-white/50 rounded-2xl p-4 border-2 border-pink-100">
                <h3 class="text-base font-bold text-purple-500 mb-2 flex items-center gap-2">
                    <span>üèÜ</span> ‡∏Ñ‡∏ô‡πÄ‡∏Å‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô
                </h3>
                <ul id="high-score-list-start" class="space-y-1 text-purple-700 text-sm"></ul>
            </div>
        </div>

        <!-- SCREEN: GAME -->
        <div id="screen-game" class="hidden glass-card p-6 md:p-8 relative z-10">
            
            <!-- Top Bar -->
            <div class="flex justify-between items-center mb-4">
                <button onclick="Game.confirmHome()" class="bg-white text-2xl w-12 h-12 rounded-full shadow-sm border-2 border-pink-100 flex items-center justify-center btn-hover-pop text-pink-400" title="‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å">üè†</button>
                
                <div class="flex items-center gap-2 bg-pink-50 px-4 py-2 rounded-full border border-pink-100">
                    <span class="text-2xl">‚≠ê</span>
                    <span class="text-xl font-bold text-purple-600">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="current-score" class="text-pink-600 text-2xl">0</span></span>
                </div>

                <button id="sound-toggle" onclick="Game.toggleAudio()" class="bg-white text-2xl w-12 h-12 rounded-full shadow-sm border-2 border-pink-100 flex items-center justify-center btn-hover-pop" title="‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á">üîä</button>
            </div>

            <!-- Progress -->
            <div class="w-full bg-pink-100 rounded-full h-5 mb-6 border-2 border-pink-50 overflow-hidden relative">
                <div class="absolute w-full h-full opacity-30 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iMiIgY3k9IjIiIHI9IjIiIGZpbGw9IiZmZmZmZiIvPjwvc3ZnPg==')]"></div>
                <div id="progress-bar" class="progress-bar bg-gradient-to-r from-pink-400 to-purple-400 h-full rounded-full" style="width: 0%"></div>
            </div>

            <!-- Image & Hint -->
            <div class="mb-6 relative mx-auto max-w-lg">
                <div class="relative bg-white p-2 rounded-3xl shadow-inner border-4 border-pink-100">
                    <div id="hint-image-container" class="w-full aspect-video rounded-2xl overflow-hidden bg-purple-50 flex items-center justify-center relative p-4">
                        <!-- SVG Injected Here -->
                        <div id="hint-text-overlay" class="absolute bottom-3 left-3 right-3 bg-white/90 backdrop-blur-sm text-purple-600 px-4 py-2 rounded-xl text-center text-lg shadow-sm border border-pink-100 font-bold z-10"></div>
                    </div>
                </div>
                
                <button onclick="Game.useHint()" id="hint-btn" class="absolute -bottom-4 -right-2 bg-yellow-300 hover:bg-yellow-400 text-yellow-800 p-3 rounded-full shadow-lg border-4 border-white btn-hover-pop transform rotate-6 z-20 flex flex-col items-center w-16 h-16 justify-center">
                    <span class="text-2xl">üí°</span>
                    <span class="text-[10px] font-bold">‡πÉ‡∏ö‡πâ‡∏Ñ‡∏≥</span>
                </button>
            </div>

            <!-- Play Sound -->
            <div class="text-center mb-6">
                <button onclick="Game.speakCurrent()" class="bg-white hover:bg-purple-50 text-purple-500 px-6 py-2 rounded-full font-bold inline-flex items-center gap-2 border-2 border-purple-100 shadow-sm btn-hover-pop">
                    <span>üì¢</span> ‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                </button>
            </div>

            <!-- Input -->
            <div id="input-area" class="space-y-4 max-w-sm mx-auto">
                <input type="text" id="answer-input" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©..." 
                    class="w-full p-4 rounded-2xl cute-input text-center text-3xl text-purple-600 uppercase tracking-widest outline-none"
                    autocomplete="off">
                <button onclick="Game.checkAnswer()" id="submit-btn" class="w-full bg-gradient-to-b from-green-400 to-green-500 text-white font-bold py-4 rounded-2xl text-xl shadow-lg border-b-4 border-green-600 btn-hover-pop">
                    ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö ‚úÖ
                </button>
            </div>

            <!-- Feedback Modal -->
            <div id="feedback-overlay" class="hidden absolute inset-0 z-30 flex items-center justify-center bg-white/80 backdrop-blur-sm rounded-3xl p-4 text-center">
                <div class="w-full max-w-md bg-white p-6 rounded-3xl shadow-2xl border-4 border-purple-100 transform transition-all scale-100">
                    <div id="feedback-emoji" class="text-8xl mb-2 animate-bounce drop-shadow-md"></div>
                    <div id="feedback-text" class="text-3xl font-bold mb-2 font-mali"></div>
                    
                    <div class="bg-yellow-50 rounded-xl p-3 mb-4 inline-block border border-yellow-100">
                        <span class="text-gray-500 text-sm">‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏∑‡∏≠</span>
                        <div id="feedback-reveal" class="text-2xl font-bold text-purple-700 tracking-wider"></div>
                    </div>
                    
                    <div class="bg-purple-50 p-4 rounded-2xl mb-6 border border-purple-100 relative overflow-hidden">
                        <div class="absolute top-0 right-0 p-1 opacity-10 text-4xl">üìö</div>
                        <p id="feedback-sentence" class="text-xl font-bold text-purple-700 italic mb-1"></p>
                        <p id="feedback-translation" class="text-lg text-purple-400"></p>
                        <button onclick="Game.speakExample()" class="mt-3 bg-purple-200 hover:bg-purple-300 text-purple-800 px-4 py-1 rounded-full text-sm font-bold transition flex items-center gap-1 mx-auto">
                            üîä ‡∏ü‡∏±‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
                        </button>
                    </div>

                    <button onclick="Game.nextQuestion()" class="w-full bg-gradient-to-r from-blue-400 to-blue-500 hover:from-blue-500 hover:to-blue-600 text-white font-bold py-3 px-8 rounded-2xl text-xl shadow-lg border-b-4 border-blue-600 btn-hover-pop flex items-center justify-center gap-2">
                        ‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡πÑ‡∏õ ‚û°Ô∏è
                    </button>
                </div>
            </div>
        </div>

        <!-- SCREEN: RESULT -->
        <div id="screen-result" class="hidden glass-card p-8 text-center relative z-10">
            <button onclick="Game.goHome()" class="absolute top-6 left-6 bg-white text-2xl w-10 h-10 rounded-full shadow-sm border-2 border-pink-100 flex items-center justify-center btn-hover-pop text-pink-400">üè†</button>

            <div class="mb-4 text-6xl animate-pulse">üéâ</div>
            <h2 class="text-3xl md:text-4xl font-bold text-purple-600 mb-2">‡∏à‡∏ö‡πÄ‡∏Å‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏à‡πâ‡∏≤!</h2>
            <p class="text-pink-400 mb-6">‡∏´‡∏ô‡∏π‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å‡πÜ ‡πÄ‡∏•‡∏¢‡∏ô‡∏∞</p>
            
            <div id="result-stars" class="star-rating mb-6 flex justify-center gap-2"></div>

            <p id="result-praise" class="text-2xl font-bold text-pink-600 mb-6 bg-pink-50 inline-block px-6 py-2 rounded-full border border-pink-100"></p>
            
            <div class="bg-gradient-to-br from-purple-50 to-pink-50 p-6 rounded-3xl mb-8 border-2 border-white shadow-inner max-w-xs mx-auto">
                <p class="text-xl text-purple-500 font-bold mb-1">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°</p>
                <p class="text-7xl font-bold text-pink-500 drop-shadow-sm" style="font-family: 'Mali', cursive;"><span id="final-score">0</span><span class="text-3xl text-pink-300">/10</span></p>
            </div>

            <div class="mb-8 text-left bg-white/60 p-4 rounded-2xl border border-pink-100">
                <h3 class="text-lg font-bold text-purple-500 mb-2 border-b border-pink-100 pb-1 text-center">üèÜ ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏Ñ‡∏ô‡πÄ‡∏Å‡πà‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
                <ul id="high-score-list-end" class="space-y-2 text-purple-700"></ul>
            </div>

            <button onclick="Game.start()" class="bg-gradient-to-b from-pink-400 to-pink-500 text-white font-bold py-4 px-10 rounded-full text-2xl shadow-lg border-b-4 border-pink-700 btn-hover-pop w-full max-w-sm">
                ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏∞! üîÑ
            </button>
        </div>
    </div>

    <!-- GAME LOGIC -->
    <script>
        const APP_ID = typeof __app_id !== 'undefined' ? __app_id : 'vocal-game-7yr';

        // --- Data ---
        const VOCABULARY = [
            { 
                word: "library", 
                svg: `<svg viewBox="0 0 100 100" class="hint-svg"><rect x="20" y="20" width="60" height="70" rx="2" fill="#d1c4e9"/><rect x="25" y="25" width="50" height="60" fill="#fff"/><rect x="30" y="30" width="10" height="50" rx="1" fill="#f48fb1"/><rect x="45" y="30" width="10" height="50" rx="1" fill="#81d4fa"/><rect x="60" y="30" width="10" height="50" rx="1" fill="#fff59d"/><text x="50" y="95" font-size="10" text-anchor="middle" fill="#7e57c2">LIBRARY</text></svg>`,
                hintText: "‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏¢‡∏≠‡∏∞‡πÜ", 
                example: "I read books at the library.", 
                exampleTrans: "‡∏â‡∏±‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏î" 
            },
            { 
                word: "cafe", 
                svg: `<svg viewBox="0 0 100 100" class="hint-svg"><circle cx="50" cy="50" r="45" fill="#e1f5fe"/><path d="M30 40 Q30 70 50 70 Q70 70 70 40 Z" fill="#fff" stroke="#81d4fa" stroke-width="3"/><path d="M70 45 Q80 45 80 55 Q80 65 70 60" fill="none" stroke="#81d4fa" stroke-width="3"/><path d="M40 30 Q45 20 40 10 M50 30 Q55 20 50 10 M60 30 Q65 20 60 10" stroke="#ffcc80" stroke-width="2" fill="none"/></svg>`,
                hintText: "‡∏£‡πâ‡∏≤‡∏ô‡∏Ç‡∏ô‡∏°‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°", 
                example: "We like to visit the cute cafe.", 
                exampleTrans: "‡∏û‡∏ß‡∏Å‡πÄ‡∏£‡∏≤‡∏ä‡∏≠‡∏ö‡πÑ‡∏õ‡∏Ñ‡∏≤‡πÄ‡∏ü‡πà‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å" 
            },
            { 
                word: "museum", 
                svg: `<svg viewBox="0 0 100 100" class="hint-svg"><rect x="10" y="30" width="80" height="60" fill="#fff3e0"/><rect x="15" y="30" width="10" height="60" fill="#ffe0b2"/><rect x="35" y="30" width="10" height="60" fill="#ffe0b2"/><rect x="55" y="30" width="10" height="60" fill="#ffe0b2"/><rect x="75" y="30" width="10" height="60" fill="#ffe0b2"/><path d="M5 30 L50 5 L95 30 Z" fill="#ffb74d"/><text x="50" y="80" font-size="20" text-anchor="middle">üèõÔ∏è</text></svg>`,
                hintText: "‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤‡πÅ‡∏•‡∏∞‡∏Ç‡∏≠‡∏á‡∏´‡∏≤‡∏¢‡∏≤‡∏Å", 
                example: "The museum has big dinosaurs.", 
                exampleTrans: "‡∏û‡∏¥‡∏û‡∏¥‡∏ò‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏°‡∏µ‡πÑ‡∏î‡πÇ‡∏ô‡πÄ‡∏™‡∏≤‡∏£‡πå‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏ç‡πà" 
            },
            { 
                word: "aquarium", 
                svg: `<svg viewBox="0 0 100 100" class="hint-svg"><rect x="10" y="20" width="80" height="60" rx="5" fill="#e0f7fa" stroke="#4dd0e1" stroke-width="3"/><path d="M10 30 Q50 35 90 30" fill="none" stroke="#b2ebf2" stroke-width="2"/><circle cx="40" cy="50" r="8" fill="#ffab91"/><path d="M40 50 L30 45 L30 55 Z" fill="#ffab91"/><circle cx="70" cy="60" r="5" fill="#ffd54f"/><path d="M70 60 L78 57 L78 63 Z" fill="#ffd54f"/><circle cx="50" cy="40" r="2" fill="#fff" opacity="0.5"/><circle cx="55" cy="35" r="3" fill="#fff" opacity="0.5"/></svg>`,
                hintText: "‡∏ó‡∏µ‡πà‡∏î‡∏π‡∏õ‡∏•‡∏≤‡πÅ‡∏•‡∏∞‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏ô‡πâ‡∏≥", 
                example: "The fish swim in the aquarium.", 
                exampleTrans: "‡∏õ‡∏•‡∏≤‡∏Å‡∏ß‡πà‡∏≤‡∏¢‡∏ô‡πâ‡∏≥‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏û‡∏¥‡∏û‡∏¥‡∏ò‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏ô‡πâ‡∏≥" 
            },
            { 
                word: "skate park", 
                svg: `<svg viewBox="0 0 100 100" class="hint-svg"><path d="M10 60 Q50 90 90 60" fill="none" stroke="#bdbdbd" stroke-width="8" stroke-linecap="round"/><rect x="30" y="40" width="40" height="10" rx="5" fill="#ef9a9a" transform="rotate(-15 50 45)"/><circle cx="35" cy="55" r="4" fill="#546e7a"/><circle cx="65" cy="45" r="4" fill="#546e7a"/></svg>`,
                hintText: "‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏ô‡∏™‡πÄ‡∏Å‡πá‡∏ï‡∏ö‡∏≠‡∏£‡πå‡∏î", 
                example: "Let's go to the skate park.", 
                exampleTrans: "‡πÑ‡∏õ‡∏™‡∏ô‡∏≤‡∏°‡∏™‡πÄ‡∏Å‡πá‡∏ï‡∏Å‡∏±‡∏ô‡πÄ‡∏ñ‡∏≠‡∏∞" 
            },
            { 
                word: "shopping centre", 
                svg: `<svg viewBox="0 0 100 100" class="hint-svg"><rect x="25" y="30" width="50" height="60" rx="5" fill="#f48fb1"/><path d="M35 30 Q35 10 50 10 Q65 10 65 30" fill="none" stroke="#f06292" stroke-width="5"/><circle cx="50" cy="50" r="10" fill="#fce4ec"/><text x="50" y="55" font-size="12" text-anchor="middle" fill="#ec407a">SALE</text></svg>`,
                hintText: "‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏•‡πà‡∏ô", 
                example: "I buy toys at the shopping centre.", 
                exampleTrans: "‡∏â‡∏±‡∏ô‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏´‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏û‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" 
            },
            { 
                word: "traffic", 
                svg: `<svg viewBox="0 0 100 100" class="hint-svg"><rect x="35" y="10" width="30" height="80" rx="5" fill="#424242"/><circle cx="50" cy="25" r="10" fill="#ef5350"/><circle cx="50" cy="50" r="10" fill="#ffee58"/><circle cx="50" cy="75" r="10" fill="#66bb6a"/></svg>`,
                hintText: "‡∏£‡∏ñ‡∏ö‡∏ô‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏ô‡∏ô", 
                example: "The traffic is moving slowly.", 
                exampleTrans: "‡∏£‡∏ñ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ä‡πâ‡∏≤‡πÜ" 
            },
            { 
                word: "helicopter", 
                svg: `<svg viewBox="0 0 100 100" class="hint-svg"><ellipse cx="50" cy="60" rx="30" ry="20" fill="#90caf9"/><path d="M20 60 L5 60 L5 50 Z" fill="#90caf9"/><rect x="45" y="35" width="10" height="10" fill="#424242"/><rect x="10" y="35" width="80" height="5" rx="2" fill="#424242"/><circle cx="60" cy="55" r="8" fill="#e3f2fd"/></svg>`,
                hintText: "‡∏¢‡∏≤‡∏ô‡∏û‡∏≤‡∏´‡∏ô‡∏∞‡∏ö‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏°‡∏µ‡πÉ‡∏ö‡∏û‡∏±‡∏î", 
                example: "The helicopter flies in the sky.", 
                exampleTrans: "‡πÄ‡∏Æ‡∏•‡∏¥‡∏Ñ‡∏≠‡∏õ‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ö‡∏¥‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏ó‡πâ‡∏≠‡∏á‡∏ü‡πâ‡∏≤" 
            },
            { 
                word: "ferry", 
                svg: `<svg viewBox="0 0 100 100" class="hint-svg"><path d="M0 70 Q25 80 50 70 T100 70 L100 100 L0 100 Z" fill="#81d4fa"/><path d="M20 60 L80 60 L70 90 L30 90 Z" fill="#ffcc80"/><rect x="35" y="40" width="30" height="20" fill="#fff"/><rect x="40" y="45" width="5" height="10" fill="#81d4fa"/><rect x="55" y="45" width="5" height="10" fill="#81d4fa"/><rect x="45" y="25" width="5" height="15" fill="#424242"/><path d="M40 25 L60 25 L60 20 Z" fill="#424242"/></svg>`,
                hintText: "‡πÄ‡∏£‡∏∑‡∏≠‡∏•‡∏≥‡πÉ‡∏´‡∏ç‡πà‡∏ó‡∏µ‡πà‡∏Ç‡πâ‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥", 
                example: "The ferry crosses the river.", 
                exampleTrans: "‡πÄ‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≤‡∏°‡∏ü‡∏≤‡∏Å‡πÅ‡∏•‡πà‡∏ô‡∏Ç‡πâ‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥" 
            },
            { 
                word: "underground", 
                svg: `<svg viewBox="0 0 100 100" class="hint-svg"><path d="M10 10 L90 10 L90 90 L10 90 Z" fill="#424242"/><circle cx="50" cy="50" r="35" fill="#212121"/><rect x="35" y="35" width="30" height="30" rx="5" fill="#eceff1"/><rect x="38" y="40" width="10" height="10" fill="#81d4fa"/><rect x="52" y="40" width="10" height="10" fill="#81d4fa"/><circle cx="40" cy="60" r="2" fill="#ef5350"/><circle cx="60" cy="60" r="2" fill="#ef5350"/></svg>`,
                hintText: "‡∏£‡∏ñ‡πÑ‡∏ü‡πÉ‡∏ï‡πâ‡∏î‡∏¥‡∏ô", 
                example: "We take the underground to travel.", 
                exampleTrans: "‡∏û‡∏ß‡∏Å‡πÄ‡∏£‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô‡∏£‡∏ñ‡πÑ‡∏ü‡πÉ‡∏ï‡πâ‡∏î‡∏¥‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á" 
            }
        ];

        // --- State ---
        const gameState = {
            queue: [],
            index: 0,
            score: 0,
            playerName: "",
            hintUsed: false,
            muted: false,
            synth: window.speechSynthesis
        };

        // --- Main Game Object ---
        const Game = {
            init: () => {
                Game.renderVocabList();
                Game.updateHighScores();
                // Pre-load/init voice
                Game.speakText("", "en-US");
            },

            renderVocabList: () => {
                const list = document.getElementById('vocab-list-preview');
                list.innerHTML = VOCABULARY.map(v => 
                    `<span class="bg-white text-pink-500 px-3 py-1 rounded-full text-sm font-bold shadow-sm border border-pink-100 hover:scale-105 transition cursor-default">${v.word}</span>`
                ).join('');
            },

            start: () => {
                const nameInput = document.getElementById('player-name').value.trim();
                if (!gameState.playerName && !nameInput) {
                    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏à‡πä‡∏∞!");
                    return;
                }
                if (nameInput) gameState.playerName = nameInput;

                // Reset state
                gameState.score = 0;
                gameState.index = 0;
                gameState.queue = Game.shuffle([...VOCABULARY]); // Randomize

                // UI Transition
                Game.showScreen('game');
                document.getElementById('current-score').textContent = 0;
                
                Game.loadQuestion();
            },

            loadQuestion: () => {
                if (gameState.index >= gameState.queue.length) {
                    Game.end();
                    return;
                }

                gameState.hintUsed = false;
                const currentQ = gameState.queue[gameState.index];
                
                // Reset UI Elements
                const input = document.getElementById('answer-input');
                input.value = "";
                input.disabled = false;
                document.getElementById('submit-btn').disabled = false;
                document.getElementById('feedback-overlay').classList.add('hidden');
                
                const hintBtn = document.getElementById('hint-btn');
                hintBtn.classList.remove('opacity-50', 'cursor-not-allowed', 'grayscale');

                document.getElementById('hint-text-overlay').textContent = currentQ.hintText;

                // Inject SVG
                const container = document.getElementById('hint-image-container');
                const overlay = document.getElementById('hint-text-overlay');
                container.innerHTML = currentQ.svg;
                container.appendChild(overlay);

                // Update Progress
                const percent = (gameState.index / gameState.queue.length) * 100;
                document.getElementById('progress-bar').style.width = `${percent}%`;

                // Auto speak
                setTimeout(() => Game.speakText(currentQ.word), 500);
            },

            checkAnswer: () => {
                const input = document.getElementById('answer-input').value.trim().toLowerCase();
                const currentQ = gameState.queue[gameState.index];
                const isCorrect = input === currentQ.word.toLowerCase();
                
                const emoji = document.getElementById('feedback-emoji');
                const text = document.getElementById('feedback-text');
                const reveal = document.getElementById('feedback-reveal');
                const sentence = document.getElementById('feedback-sentence');
                const trans = document.getElementById('feedback-translation');

                if (isCorrect) {
                    if (!gameState.hintUsed) gameState.score++;
                    emoji.textContent = "üåü";
                    text.textContent = "‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å";
                    text.className = "text-3xl font-bold mb-2 text-green-500 font-mali";
                    Game.playSound('correct');
                } else {
                    if (gameState.score > 0) gameState.score--;
                    emoji.textContent = "ü•∫";
                    text.textContent = "‡∏ú‡∏¥‡∏î‡∏à‡πâ‡∏≤ ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏£‡∏ô‡∏∞";
                    text.className = "text-3xl font-bold mb-2 text-pink-500 font-mali";
                    Game.playSound('wrong');
                }

                // Update Feedback Content
                document.getElementById('current-score').textContent = gameState.score;
                reveal.textContent = currentQ.word;
                sentence.textContent = `"${currentQ.example}"`;
                trans.textContent = currentQ.exampleTrans;

                document.getElementById('feedback-overlay').classList.remove('hidden');
                Game.speakText(currentQ.example);
            },

            nextQuestion: () => {
                gameState.index++;
                Game.loadQuestion();
            },

            useHint: () => {
                if (gameState.hintUsed) return;
                gameState.hintUsed = true;

                const currentQ = gameState.queue[gameState.index];
                const firstLetter = currentQ.word.charAt(0).toUpperCase();
                
                const input = document.getElementById('answer-input');
                input.value = firstLetter;
                input.focus();

                const hintBtn = document.getElementById('hint-btn');
                hintBtn.classList.add('opacity-50', 'cursor-not-allowed', 'grayscale');

                const msg = new SpeechSynthesisUtterance("‡∏Ñ‡∏≥‡∏ô‡∏µ‡πâ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß " + firstLetter);
                msg.lang = 'th-TH';
                gameState.synth.speak(msg);
            },

            end: () => {
                Game.showScreen('result');
                document.getElementById('final-score').textContent = gameState.score;

                // Determine Stars
                let stars = "‚≠ê";
                let praise = "‡∏ù‡∏∂‡∏Å‡∏ù‡∏ô‡∏ö‡πà‡∏≠‡∏¢‡πÜ ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏Å‡πá‡πÄ‡∏Å‡πà‡∏á‡∏ô‡∏∞!";
                if (gameState.score >= 8) {
                    stars = "‚≠ê‚≠ê‚≠ê";
                    praise = "‡∏´‡∏ô‡∏π‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î‡∏°‡∏≤‡∏Å‡πÄ‡∏•‡∏¢!";
                } else if (gameState.score >= 5) {
                    stars = "‚≠ê‚≠ê";
                    praise = "‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î‡∏ô‡∏∞!";
                }

                document.getElementById('result-stars').textContent = stars;
                document.getElementById('result-praise').textContent = praise;

                Game.saveScore();
                Game.updateHighScores();
            },

            // --- Navigation & Helpers ---
            showScreen: (screenName) => {
                ['start', 'game', 'result'].forEach(s => {
                    document.getElementById(`screen-${s}`).classList.add('hidden');
                });
                document.getElementById(`screen-${screenName}`).classList.remove('hidden');
            },

            confirmHome: () => {
                if (confirm("‡πÅ‡∏ô‡πà‡πÉ‡∏à‡πÑ‡∏´‡∏°‡∏à‡πä‡∏∞‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å? ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏ô‡∏∞")) {
                    Game.goHome();
                }
            },

            goHome: () => {
                Game.showScreen('start');
                document.getElementById('feedback-overlay').classList.add('hidden');
                document.getElementById('answer-input').value = "";
                document.getElementById('player-name').value = "";
                gameState.playerName = "";
            },

            shuffle: (array) => {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            },

            // --- Audio ---
            toggleAudio: () => {
                gameState.muted = !gameState.muted;
                const btn = document.getElementById('sound-toggle');
                btn.textContent = gameState.muted ? "üîá" : "üîä";
                btn.classList.toggle('bg-gray-200');
                if (gameState.muted) gameState.synth.cancel();
            },

            speakCurrent: () => {
                if (gameState.queue[gameState.index]) {
                    Game.speakText(gameState.queue[gameState.index].word);
                }
            },

            speakExample: () => {
                if (gameState.queue[gameState.index]) {
                    Game.speakText(gameState.queue[gameState.index].example);
                }
            },

            speakText: (text, lang = "en-US") => {
                if (gameState.muted || !text) return;
                const utter = new SpeechSynthesisUtterance(text);
                utter.lang = lang;
                utter.rate = 0.8;
                
                // Attempt to select a female voice
                const voices = gameState.synth.getVoices();
                const femaleVoice = voices.find(v => v.lang.startsWith('en') && (v.name.includes('Female') || v.name.includes('Samantha') || v.name.includes('Google US English')));
                if (femaleVoice && lang === "en-US") utter.voice = femaleVoice;

                gameState.synth.speak(utter);
            },

            playSound: (type) => {
                if (gameState.muted) return;
                const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);

                const now = audioCtx.currentTime;
                if (type === 'correct') {
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(523.25, now);
                    osc.frequency.setValueAtTime(659.25, now + 0.1);
                    osc.frequency.setValueAtTime(783.99, now + 0.2);
                    osc.frequency.setValueAtTime(1046.50, now + 0.3);
                    gain.gain.setValueAtTime(0.1, now);
                    gain.gain.linearRampToValueAtTime(0, now + 0.5);
                    osc.start(now);
                    osc.stop(now + 0.5);
                } else {
                    osc.type = 'triangle';
                    osc.frequency.setValueAtTime(300, now);
                    osc.frequency.linearRampToValueAtTime(100, now + 0.4);
                    gain.gain.setValueAtTime(0.1, now);
                    gain.gain.linearRampToValueAtTime(0, now + 0.4);
                    osc.start(now);
                    osc.stop(now + 0.4);
                }
            },

            // --- Storage ---
            saveScore: () => {
                let scores = JSON.parse(localStorage.getItem(`${APP_ID}_scores`) || "[]");
                scores.push({ name: gameState.playerName, score: gameState.score, date: new Date().toISOString() });
                scores.sort((a, b) => b.score - a.score);
                scores = scores.slice(0, 5);
                localStorage.setItem(`${APP_ID}_scores`, JSON.stringify(scores));
            },

            updateHighScores: () => {
                const scores = JSON.parse(localStorage.getItem(`${APP_ID}_scores`) || "[]");
                const top5 = scores.sort((a, b) => b.score - a.score).slice(0, 5);
                
                ['high-score-list-start', 'high-score-list-end'].forEach(id => {
                    const el = document.getElementById(id);
                    if (el) {
                        el.innerHTML = top5.length > 0 
                            ? top5.map((s, i) => `<li class="flex justify-between items-center p-2 rounded-lg ${i === 0 ? 'bg-yellow-100 font-bold border border-yellow-200' : 'bg-white/40'}">
                                <span class="flex items-center gap-2"><span class="text-xs bg-pink-200 text-pink-700 px-2 rounded-full">${i+1}</span> ${s.name}</span>
                                <span class="text-pink-500 font-bold">${s.score} <span class="text-xs">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</span></span>
                              </li>`).join('')
                            : '<li class="text-center text-purple-300 py-2 italic text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡πâ‡∏≤ ‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡πÅ‡∏£‡∏Å‡∏Å‡∏±‡∏ô!</li>';
                    }
                });
            }
        };

        // Initialize
        window.onload = Game.init;

    </script>
</body>
</html>
